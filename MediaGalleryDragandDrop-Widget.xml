<scriptedContentFragments>
	<scriptedContentFragment name="${resource:MediaGalleries_MediaGalleryDragAndDrop_Name}" version="10.1.8.10498" description="${resource:MediaGalleries_MediaGalleryDragAndDrop_Description}" instanceIdentifier="72597c89a4c24cc9958a0472397ec379" theme="" isCacheable="true" varyCacheByUser="true" showHeaderByDefault="false" cssClass="media-gallery-dragdrop">
		<contentScript><![CDATA[
#set ($gallery = false)
#set ($gallery = $core_v2_gallery.Current)
#if (!$gallery || $core_v2_widget.IsInWidgetPreviewMode)
    $core_v2_widget.Hide()
#end
#if(!$core_v2_nodePermission.Get('mediagalleries',$gallery.Id,$core_v2_mediaPermissions.CreatePost).IsAllowed || !$core_v2_nodePermission.Get('mediagalleries',$gallery.Id,$core_v2_mediaPermissions.AttachFileLocal).IsAllowed)
    $core_v2_widget.Hide()
#end

#set($uploadContextId = $core_v2_uploadedFile.CreateContextId())

#registerEndOfPageHtml('telligent.evolution.widgets.MediaGalleryDragAndDrop')
    <script type="text/javascript" src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('ui.js'))"></script>
#end
#registerEndOfPageHtml()
<script type="text/javascript">
jQuery(document).ready(function(j) {
    j.telligent.evolution.widgets.mediaGalleryDragAndDrop.register({
			uploadUrl: '$core_v2_encoding.JavascriptEncode($core_v2_uploadedFile.GetUploadUrl($uploadContextId))',
			uploadContextId: '$uploadContextId.ToString()',
			mediaGalleryId: $gallery.Id,
			finalizeUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('finalize.vm'))',
			text: {
				upload: '$core_v2_encoding.JavascriptEncode($core_v2_language.FormatString($core_v2_language.GetResource('upload'), $gallery.Name))',
				uploadProgress: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('upload-progress'))',
				uploadComplete: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('upload-complete'))',
				uploadError: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('upload-error'))'
			}
    });
});
</script>
#end
            ]]></contentScript>
		<languageResources><language key="en-us">
  <resource name="MediaGalleries_MediaGalleryDragAndDrop_Description">Enables drag and drop uploading into the current media gallery.</resource>
  <resource name="MediaGalleries_MediaGalleryDragAndDrop_Name">Media Gallery - Drag and Drop </resource>
  <resource name="upload">Drop files to upload to '{0}'</resource>
  <resource name="upload-complete">Uploaded '{0}'</resource>
  <resource name="upload-error">An error occurred while uploading a file.</resource>
  <resource name="upload-progress">Uploading '{0}' ({1}%)...</resource>
</language>
<language key="zh-cn">
  <resource name="MediaGalleries_MediaGalleryDragAndDrop_Description">允许通过拖放操作上传到当前媒体库中。</resource>
  <resource name="MediaGalleries_MediaGalleryDragAndDrop_Name">媒体库 - 拖放</resource>
  <resource name="upload">拖动文件以上传到“{0}”</resource>
  <resource name="upload-complete">已上传“{0}”</resource>
  <resource name="upload-error">上传文件时出错。</resource>
  <resource name="upload-progress">正在上传“{0}”({1}%)...</resource>
</language>
<language key="zh-tw">
  <resource name="MediaGalleries_MediaGalleryDragAndDrop_Description">啟用拖放以上傳到目前的媒體資源庫中。</resource>
  <resource name="MediaGalleries_MediaGalleryDragAndDrop_Name">媒體資源庫 - 拖放</resource>
  <resource name="upload">放置檔案以上傳至「{0}」</resource>
  <resource name="upload-complete">已上傳「{0}」</resource>
  <resource name="upload-error">上傳檔案時發生錯誤。</resource>
  <resource name="upload-progress">上傳中「{0}」({1}%)...</resource>
</language></languageResources>
		<requiredContext>
			<context id="a51614fd19f7416ca89453788ac15794" />
		</requiredContext>
		<files>
			<file name="finalize.vm">77u/I2lmICgkY29yZV92Ml9wYWdlLklzUG9zdCkNCgkkY29yZV92Ml9wYWdlLlNldENvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi9qc29uJykNCg0KCSNzZXQoJGZpbGVOYW1lID0gJGNvcmVfdjJfcGFnZS5HZXRGb3JtVmFsdWUoJ0ZpbGVOYW1lJykpDQoJI3NldCgkZ2FsbGVyeUlkID0gJGNvcmVfdjJfdXRpbGl0eS5QYXJzZUludCgkY29yZV92Ml9wYWdlLkdldEZvcm1WYWx1ZSgnR2FsbGVyeUlkJykpKQ0KCSNzZXQoJGZpbGVDb250ZXh0SWQgPSBmYWxzZSkNCgkjc2V0KCRmaWxlQ29udGV4dElkID0gJGNvcmVfdjJfcGFnZS5HZXRGb3JtVmFsdWUoJ0ZpbGVDb250ZXh0SWQnKSkNCg0KCSNzZXQoJG9wdGlvbnMgPSAiJXt9IikNCgkkb3B0aW9ucy5BZGQoJ05hbWUnLCAkZmlsZU5hbWUpDQoJI3NldCgkY29udGVudFR5cGUgPSAkY29yZV92Ml91aS5HZXRNaW1lVHlwZSgkZmlsZU5hbWUpKQ0KCSRvcHRpb25zLkFkZCgnRmlsZVVwbG9hZENvbnRleHQnLCRmaWxlQ29udGV4dElkKQ0KCSRvcHRpb25zLkFkZCgnRmlsZU5hbWUnLCRmaWxlLk5hbWUpDQoJJG9wdGlvbnMuQWRkKCdDb250ZW50VHlwZScsICRjb250ZW50VHlwZSkNCg0KCSNzZXQoJG1lZGlhID0gZmFsc2UpDQoJI3NldCgkbWVkaWEgPSAkY29yZV92Ml9tZWRpYS5DcmVhdGUoJGdhbGxlcnlJZCwgJGZpbGVOYW1lLCAkY29udGVudFR5cGUsICRmaWxlTmFtZSwgJG9wdGlvbnMpKQ0KCSNpZigkbWVkaWEuSGFzRXJyb3JzKCkpDQoJCSRjb3JlX3YyX3BhZ2UuU2VuZEpzb25FcnJvcigkbWVkaWEuRXJyb3JzKQ0KCSNlbHNlDQoJCXsicmVkaXJlY3RVcmwiOiIkY29yZV92Ml9lbmNvZGluZy5KYXZhc2NyaXB0RW5jb2RlKCRtZWRpYS5VcmwpIn0NCgkjZW5kDQojZW5kDQo=</file>
			<file name="ui.js">KGZ1bmN0aW9uKCQsIGdsb2JhbCl7DQoNCgl2YXIgbm90aWZpY2F0aW9uSWQgPSAnZHJhZ2Ryb3BfJzsNCg0KCWZ1bmN0aW9uIGhpZGVVcGxvYWRQcm9ncmVzcyhvcHRpb25zKSB7DQoJCWlmIChvcHRpb25zLmN1cnJlbnROb3RpZmljYXRpb25JZCkgew0KCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm5vdGlmaWNhdGlvbnMuaGlkZShvcHRpb25zLmN1cnJlbnROb3RpZmljYXRpb25JZCk7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBzaG93VXBsb2FkUHJvZ3Jlc3Mob3B0aW9ucywgZmlsZU5hbWUsIHBlcmNlbnRhZ2UpIHsNCgkJb3B0aW9ucy5jdXJyZW50Tm90aWZpY2F0aW9uSWQgPSBub3RpZmljYXRpb25JZCArIGZpbGVOYW1lOw0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubm90aWZpY2F0aW9ucy5zaG93KG9wdGlvbnMudGV4dC51cGxvYWRQcm9ncmVzcy5yZXBsYWNlKC9cezBcfS9nLCBmaWxlTmFtZSkucmVwbGFjZSgvXHsxXH0vZywgcGVyY2VudGFnZSB8fCAnMCcpLCB7DQoJCQkJdHlwZTogJ3N1Y2Nlc3MnLA0KCQkJCWlkOiBub3RpZmljYXRpb25JZCArIGZpbGVOYW1lLA0KCQkJCWR1cmF0aW9uOiA5MDAwMCAvKiB1cGxvYWQgaXMgYWRqdXN0ZWQgdG8gc3VwcG9ydCBjb21wbGV0aW5nIGEgY2h1bmsgaW4gNDUgc2Vjb25kcywgc28gc2hvdyB0aGUgbWVzc2FnZSBmb3IgYXQgbGVhc3QgdHdpY2UgdGhhdCAqLw0KCQkJfSk7DQoJfQ0KDQoJZnVuY3Rpb24gZmluYWxpemVVcGxvYWQob3B0aW9ucywgZmlsZU5hbWUpIHsNCgkJb3B0aW9ucy5jdXJyZW50Tm90aWZpY2F0aW9uSWQgPSBub3RpZmljYXRpb25JZCArIGZpbGVOYW1lOw0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ucG9zdCh7DQoJCQl1cmw6IG9wdGlvbnMuZmluYWxpemVVcmwsDQoJCQlkYXRhOiB7DQoJCQkJRmlsZU5hbWU6IGZpbGVOYW1lLA0KCQkJCUdhbGxlcnlJZDogb3B0aW9ucy5tZWRpYUdhbGxlcnlJZCwNCgkJCQlGaWxlQ29udGV4dElkOiBvcHRpb25zLnVwbG9hZENvbnRleHRJZA0KCQkJfQ0KCQl9KQ0KCQkJLmRvbmUoZnVuY3Rpb24oKSB7DQoJCQkJb3B0aW9ucy5oYXNTdWNjZXNzZnVsVXBsb2FkcyA9IHRydWU7DQoJCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm5vdGlmaWNhdGlvbnMuc2hvdyhvcHRpb25zLnRleHQudXBsb2FkQ29tcGxldGUucmVwbGFjZSgvXHswXH0vZywgZmlsZU5hbWUpLCB7DQoJCQkJCXR5cGU6ICdzdWNjZXNzJywNCgkJCQkJaWQ6IG5vdGlmaWNhdGlvbklkICsgZmlsZU5hbWUsDQoJCQkJCWR1cmF0aW9uOiA1MDAwDQoJCQkJfSk7DQoJCQl9KQ0KCQkJLmZhaWwoZnVuY3Rpb24oKSB7DQoJCQkJaGlkZVVwbG9hZFByb2dyZXNzKG9wdGlvbnMpOw0KCQkJfSkNCgkJCS5hbHdheXMoZnVuY3Rpb24oKSB7DQoJCQkJaWYgKG9wdGlvbnMuaGFzU3VjY2Vzc2Z1bFVwbG9hZHMgJiYgIW9wdGlvbnMuaXNVcGxvYWRpbmcpIHsNCgkJCQkJZ2xvYmFsLmNsZWFyVGltZW91dChvcHRpb25zLnJlbG9hZFRpbWVvdXQpOw0KCQkJCQlvcHRpb25zLnJlbG9hZFRpbWVvdXQgPSBnbG9iYWwuc2V0VGltZW91dChmdW5jdGlvbigpIHsNCgkJCQkJCWdsb2JhbC5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7DQoJCQkJCX0sIDI1MDApOw0KCQkJCX0NCgkJCX0pDQoJfQ0KDQoJZnVuY3Rpb24gc2hvd1NoYWRlKG9wdGlvbnMsIG1lc3NhZ2UpIHsNCgkJZ2xvYmFsLmNsZWFyVGltZW91dChvcHRpb25zLmhpZGVUaW1lb3V0KTsNCiAgICB2YXIgd2lkdGggPSAkKCdib2R5Jykud2lkdGgoKTsNCgkJdmFyIGhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTsNCiAgICBpZiAobWVzc2FnZSkgew0KICAgICAgb3B0aW9ucy5zaGFkZU1lc3NhZ2UNCiAgICAgICAgLmh0bWwobWVzc2FnZSkNCgkJCQkuaGVpZ2h0KGhlaWdodCkNCgkgICAgICAud2lkdGgod2lkdGgpDQoJCQkJLnNob3coKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBvcHRpb25zLnNoYWRlTWVzc2FnZS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpOw0KICAgIH0NCiAgICBvcHRpb25zLnNoYWRlDQogICAgICAuaGVpZ2h0KGhlaWdodCkNCiAgICAgIC53aWR0aCh3aWR0aCkNCiAgICAgIC5zaG93KCk7DQoJfQ0KDQoJZnVuY3Rpb24gaGlkZVNoYWRlKG9wdGlvbnMpIHsNCgkJZ2xvYmFsLmNsZWFyVGltZW91dChvcHRpb25zLmhpZGVUaW1lb3V0KTsNCiAgICBvcHRpb25zLmhpZGVUaW1lb3V0ID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgb3B0aW9ucy5zaGFkZS5oaWRlKCk7DQogICAgICBvcHRpb25zLnNoYWRlTWVzc2FnZS5oaWRlKCk7DQogICAgfSwgOTk5KTsNCgl9DQoNCglpZiAodHlwZW9mICQudGVsbGlnZW50ID09PSAndW5kZWZpbmVkJykgeyAkLnRlbGxpZ2VudCA9IHt9OyB9DQoJaWYgKHR5cGVvZiAkLnRlbGxpZ2VudC5ldm9sdXRpb24gPT09ICd1bmRlZmluZWQnKSB7ICQudGVsbGlnZW50LmV2b2x1dGlvbiA9IHt9OyB9DQoJaWYgKHR5cGVvZiAkLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cyA9PT0gJ3VuZGVmaW5lZCcpIHsgJC50ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMgPSB7fTsgfQ0KCSQudGVsbGlnZW50LmV2b2x1dGlvbi53aWRnZXRzLm1lZGlhR2FsbGVyeURyYWdBbmREcm9wID0gew0KCQlyZWdpc3RlcjogZnVuY3Rpb24ob3B0aW9ucykgew0KCQkJb3B0aW9ucy5oYXNTdWNjZXNzZnVsVXBsb2FkcyA9IGZhbHNlOw0KCQkJb3B0aW9ucy5zaGFkZUNvbnRhaW5lciA9ICQoJzxkaXY+PC9kaXY+JykNCgkJCQkuYWRkQ2xhc3MoJ2RyYWctZHJvcC1jb250YWluZXInKQ0KCQkJCS5jc3Moew0KCQkJCQlwb3NpdGlvbjogJ2ZpeGVkJywNCgkJCQkJdG9wOiAnMHB4JywNCgkJCQkJbGVmdDogJzBweCcNCgkJCQl9KQ0KCQkJCS5hcHBlbmRUbygkKCdib2R5JykpOw0KDQoJCQlvcHRpb25zLnNoYWRlID0gJCgnPGRpdj48L2Rpdj4nKQ0KCQkJCS5hZGRDbGFzcygnZHJhZy1kcm9wLXNoYWRlJykNCgkJCQkuY3NzKHsNCgkJCQkJcG9zaXRpb246ICdhYnNvbHV0ZScsDQoJCQkJCWxlZnQ6ICcwcHgnLA0KCQkJCQl0b3A6ICcwcHgnDQoJCQkJfSkNCgkJCQkuaGlkZSgpDQoJCQkJLmFwcGVuZFRvKG9wdGlvbnMuc2hhZGVDb250YWluZXIpOw0KDQoJCQlvcHRpb25zLnNoYWRlTWVzc2FnZSA9ICQoJzxkaXY+PC9kaXY+JykNCgkJCQkuYWRkQ2xhc3MoJ2RyYWctZHJvcC1tZXNzYWdlJykNCgkJCQkuY3NzKHsNCgkJCQkJcG9zaXRpb246ICdhYnNvbHV0ZScsDQoJCQkJCWxlZnQ6ICcwcHgnLA0KCQkJCQl0b3A6ICcwcHgnDQoJCQkJfSkNCgkJCQkuaGlkZSgpDQoJCQkJLmFwcGVuZFRvKG9wdGlvbnMuc2hhZGVDb250YWluZXIpOw0KDQoJCQkkKCdib2R5JykNCgkJCQkub24oJ2RyYWdvdmVyLm1lZGlhZ2FsbGVyeWRyYWdkcm9wIGRyYWdlbnRlci5tZWRpYWdhbGxlcnlkcmFnZHJvcCcsIGZ1bmN0aW9uICgpIHsNCgkJCQkJc2hvd1NoYWRlKG9wdGlvbnMsIG9wdGlvbnMudGV4dC51cGxvYWQpOw0KCQkJCX0pLm9uKCdkcmFnbGVhdmUubWVkaWFnYWxsZXJ5ZHJhZ2Ryb3AgZHJhZ2VuZC5tZWRpYWdhbGxlcnlkcmFnZHJvcCBkcm9wLm1lZGlhZ2FsbGVyeWRyYWdkcm9wIG1vdXNlb3V0Lm1lZGlhZ2FsbGVyeWRyYWdkcm9wJywgZnVuY3Rpb24gKCkgew0KCQkJCQloaWRlU2hhZGUob3B0aW9ucyk7DQoJCQkJfSkNCgkJCQkuZ2xvd1VwbG9hZCh7DQoJCQkJCWZpbGVGaWx0ZXI6IG51bGwsDQoJCQkJCXJlbmRlck1vZGU6ICdkcmFnZHJvcCcsDQoJCQkJCXVwbG9hZFVybDogb3B0aW9ucy51cGxvYWRVcmwNCgkJCQl9KQ0KCQkJCS5vbignZ2xvd1VwbG9hZEVycm9yJywgZnVuY3Rpb24gKCkgew0KCQkJCQloaWRlVXBsb2FkUHJvZ3Jlc3Mob3B0aW9ucyk7DQoJCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5ub3RpZmljYXRpb25zLnNob3cob3B0aW9ucy50ZXh0LnVwbG9hZEVycm9yLCB7DQoJCQkJCQl0eXBlOiAnZXJyb3InDQoJCQkJCX0pDQoJCQkJfSkNCgkJCQkub24oJ2dsb3dVcGxvYWRGaWxlUHJvZ3Jlc3MnLCBmdW5jdGlvbiAoZSwgZCkgew0KCQkJCQlvcHRpb25zLmlzVXBsb2FkaW5nID0gdHJ1ZTsNCgkJCQkJc2hvd1VwbG9hZFByb2dyZXNzKG9wdGlvbnMsIGQubmFtZSwgZC5wZXJjZW50KTsNCgkJCQl9KQ0KCQkJCS5vbignZ2xvd1VwbG9hZENvbXBsZXRlJywgZnVuY3Rpb24gKGUsIGYpIHsNCgkJCQkJZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJCQlzaG93VXBsb2FkUHJvZ3Jlc3Mob3B0aW9ucywgZi5uYW1lLCAxMDApOw0KCQkJCQkJZmluYWxpemVVcGxvYWQob3B0aW9ucywgZi5uYW1lKTsNCgkJCQkJfSwgOSk7DQoJCQkJfSkNCgkJCQkub24oJ2dsb3dVcGxvYWRzQ29tcGxldGUnLCBmdW5jdGlvbigpIHsNCgkJCQkJb3B0aW9ucy5pc1VwbG9hZGluZyA9IGZhbHNlOw0KCQkJCX0pOw0KDQoJCQkJb3B0aW9ucy5lbmFibGVkID0gdHJ1ZTsNCg0KCQkJJChkb2N1bWVudCkub24oJ2N1c3RvbWl6ZXBhZ2UnLCBmdW5jdGlvbigpIHsNCgkJCQlpZiAob3B0aW9ucy5lbmFibGVkKSB7DQoJCQkJCW9wdGlvbnMuZW5hYmxlZCA9IGZhbHNlOw0KDQoJCQkJCSQoJ2JvZHknKQ0KCQkJCQkJLm9mZignLm1lZGlhZ2FsbGVyeWRyYWdkcm9wJykNCgkJCQkJCS5nbG93VXBsb2FkKCdkZXN0cm95Jyk7DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCgl9Ow0KDQp9KShqUXVlcnksIHdpbmRvdyk7DQo=</file>
		</files>
	</scriptedContentFragment>
</scriptedContentFragments>