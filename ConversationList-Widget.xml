<scriptedContentFragments>
	<scriptedContentFragment name="${resource:Messages_ConversationList_Name}" version="10.1.8.10498" description="${resource:Messages_ConversationList_Description}" instanceIdentifier="6f42539c0d36478bba8627b06f3e896f" theme="" isCacheable="true" varyCacheByUser="true" showHeaderByDefault="false" cssClass="conversation-list">
		<contentScript><![CDATA[

#set($accessingUser = $core_v2_user.Accessing)
#if(!$core_v2_user.IsRegistered($accessingUser.Id))
    $core_v2_widget.Hide()
#end

#set ($conversationListId = $core_v2_widget.UniqueId('ConversationList'))

<ul class="content-list content conversations" id="$core_v2_encoding.HtmlAttributeEncode($conversationListId)"></ul>

#registerEndOfPageHtml('telligent.evolution.widgets.conversationList')
    <script src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('ui.js'))"></script>
#end
#registerEndOfPageHtml()
    <script>
    jQuery(function() {
        jQuery.telligent.evolution.widgets.conversationList.register({
            wrapper : '#${core_v2_widget.WrapperElementId}',
            conversationsUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.Conversations())',
            conversationList: '#$core_v2_encoding.JavascriptEncode($conversationListId)',
            conversationListUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('conversations-page.vm'))',
            conversationNotificationTypeId: '$core_v2_conversationMessage.NotificationTypeId'
        });
    });
    </script>
#end
        ]]></contentScript>
		<headerScript><![CDATA[
$core_v2_widget.ApplyTokens($core_v2_widget.GetStringValue('fragmentHeader', '${resource:Messages_ConversationList_Name}'))
    ]]></headerScript>
		<configuration><![CDATA[
<propertyGroup id="options" resourceName="Options">
    <property id="fragmentHeader" resourceName="CF_Title" dataType="string" defaultValue="${resource:Messages_ConversationList_Name}" controlType="Telligent.Evolution.Controls.ContentFragmentTokenStringControl, Telligent.Evolution.Platform" />
</propertyGroup>
      ]]></configuration>
		<languageResources><language key="en-us">
  <resource name="Messages_ConversationList_Name">Conversation List</resource>
  <resource name="Messages_ConversationList_Description">Displays list of conversations for the current user.</resource>
  <resource name="Options">Options</resource>
  <resource name="CF_Title">Widget Title</resource>
</language>
<language key="zh-cn">
  <resource name="Messages_ConversationList_Name">对话列表</resource>
  <resource name="Messages_ConversationList_Description">显示当前用户的对话列表。</resource>
  <resource name="Options">选项</resource>
  <resource name="CF_Title">小组件标题</resource>
</language>
<language key="zh-tw">
  <resource name="Messages_ConversationList_Name">交談清單</resource>
  <resource name="Messages_ConversationList_Description">顯示目前使用者的交談清單。</resource>
  <resource name="Options">選項</resource>
  <resource name="CF_Title">Widget 標題</resource>
</language></languageResources>
		<files>
			<file name="conversations.vm">77u/I3NldCAoJGRhdGVUaW1lRm9ybWF0ID0gInl5eXktTU0tZGRUSEg6bW06c3MiKQ0KI3NldCAoJHBhZ2VTaXplID0gMTApDQojc2V0ICgkY29udmVyc2F0aW9ucyA9ICRjb3JlX3YyX2NvbnZlcnNhdGlvbi5MaXN0KCIleyBQYWdlSW5kZXggPSAnJHtwYWdlSW5kZXh9JywgUGFnZVNpemUgPSAnJHtwYWdlU2l6ZX0nfSIpKQ0KI3NldCAoJG1heFBhcnRpY2lwYW50QXZhdGFycyA9IDUpDQojc2V0ICgkYWNjZXNzaW5nVXNlciA9ICRjb3JlX3YyX3VzZXIuQWNjZXNzaW5nKQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJHRvdGFsUGFnZWQgPSAoJGNvbnZlcnNhdGlvbnMuUGFnZUluZGV4ICsgMSkgKiAkY29udmVyc2F0aW9ucy5QYWdlU2l6ZSkNCiNpZiAoJGNvbnZlcnNhdGlvbnMuVG90YWxDb3VudCA+ICR0b3RhbFBhZ2VkKQ0KICAgICNzZXQgKCRoYXNNb3JlID0gdHJ1ZSkNCiNlbmQNCg0KI2ZvcmVhY2ggKCRjb252ZXJzYXRpb24gaW4gJGNvbnZlcnNhdGlvbnMpDQogICAgI3NldCAoJGxhc3RNZXNzYWdlID0gJGNvbnZlcnNhdGlvbi5MYXN0TWVzc2FnZSkNCiAgICAjc2V0ICgkaWQgPSAkY29yZV92Ml93aWRnZXQuVW5pcXVlSWQoImNvbnZlcnNhdGlvbi0ke2NvbnZlcnNhdGlvbi5JZH0iKSkNCiAgICA8bGkgY2xhc3M9ImNvbnRlbnQtaXRlbSBjb252ZXJzYXRpb24gI2lmKCEkY29udmVyc2F0aW9uLkhhc1JlYWQpIHVucmVhZCAjZW5kIg0KICAgICAgICBpZD0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkaWQpIg0KICAgICAgICBkYXRhLWNvbnZlcnNhdGlvbmlkPSIkIWNvbnZlcnNhdGlvbi5JZCINCiAgICAgICAgZGF0YS1jb252ZXJzYXRpb251cmw9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGNvbnZlcnNhdGlvbi5VcmwpIg0KICAgICAgICBkYXRhLWxhc3R1cGRhdGU9IiQhY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXREYXRlKCRsYXN0TWVzc2FnZS5DcmVhdGVkRGF0ZSwgJGRhdGVUaW1lRm9ybWF0KSINCiAgICAgICAgI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoNCiAgICAgICAgPGRpdiBjbGFzcz0icG9zdC1hdXRob3IiPg0KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImF2YXRhciI+DQogICAgICAgICAgICAgICAgPGEgaHJlZj0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkbGFzdE1lc3NhZ2UuQXV0aG9yLlVybCkiIGNsYXNzPSJpbnRlcm5hbC1saW5rIHZpZXctdXNlci1wcm9maWxlIj4NCiAgICAgICAgICAgICAgICAgICAgJGNvcmVfdjJfdWkuR2V0UmVzaXplZEltYWdlSHRtbCgkbGFzdE1lc3NhZ2UuQXV0aG9yLkF2YXRhclVybCwgNDAsIDQwLCAiJXtib3JkZXI9JzAnLCBhbHQ9JGNvbnRlbnQuSHRtbE5hbWUoJ1dlYicpLCBSZXNpemVNZXRob2Q9J1pvb21BbmRDcm9wJyxib3JkZXI9JzAnfSIpDQogICAgICAgICAgICAgICAgPC9hPg0KICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0icG9zdC1hdXRob3JzIj4NCgkJCSNzZXQgKCREUSA9ICciJykNCgkJCSNzZXQgKCRhdXRob3JzID0gIiIpDQoJCQkjZm9yZWFjaCAoJHBhcnRpY2lwYW50IGluICRjb252ZXJzYXRpb24uUGFydGljaXBhbnRzKQ0KCQkJCSNzZXQgKCRhdXRob3JzID0gIiRhdXRob3JzJHBhcnRpY2lwYW50LkRpc3BsYXlOYW1lIikNCgkJCSNiZXR3ZWVuDQoJCQkJI3NldCAoJGF1dGhvcnMgPSAiJGF1dGhvcnMsICIpDQoJCQkjZW5kDQoJCQkkYXV0aG9ycw0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudCI+DQogICAgICAgICAgICAjc2V0ICgkZXhjZXJwdCA9ICRjb3JlX3YyX2xhbmd1YWdlLlRydW5jYXRlKCRsYXN0TWVzc2FnZS5IdG1sRGVzY3JpcHRpb24oJ1dlYicpLCA1MCwgJ+KApicpKQ0KICAgICAgICAgICAgI2lmICgkZXhjZXJwdC5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgICAgICAjc2V0ICgkZXhjZXJwdCA9ICRjb3JlX3YyX2xhbmd1YWdlLlRydW5jYXRlKCRjb252ZXJzYXRpb24uRmlyc3RNZXNzYWdlLlN1YmplY3QsIDUwLCAn4oCmJykpDQogICAgICAgICAgICAjZW5kDQogICAgICAgICAgICAkZXhjZXJwdA0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0icG9zdC1kYXRlIj4NCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ2YWx1ZSI+JGNvcmVfdjJfbGFuZ3VhZ2UuRm9ybWF0QWdvRGF0ZSgkY29udmVyc2F0aW9uLkxhc3RNZXNzYWdlLkNyZWF0ZWREYXRlKTwvc3Bhbj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9saT4NCiNlbmQNCjxzcGFuIGNsYXNzPSJoaWRkZW4gbWV0YSIgZGF0YS10b3RhbGNvdW50PSIkIWNvbnZlcnNhdGlvbnMuVG90YWxDb3VudCI+PC9zcGFuPg==</file>
			<file name="conversations-page.vm">77u/I3NldCAoJHBhZ2VJbmRleCA9IDApDQojc2V0ICgkcGFnZUluZGV4ID0gJGNvcmVfdjJfdXRpbGl0eS5QYXJzZUludCgkY29yZV92Ml9wYWdlLkdldFF1ZXJ5U3RyaW5nVmFsdWUoJ3BhZ2VJbmRleCcpKSkNCiRjb3JlX3YyX3dpZGdldC5FeGVjdXRlRmlsZSgnY29udmVyc2F0aW9ucy52bScp</file>
			<file name="ui.js">LyoNClB1Ymxpc2hlcw0KICAgIHdpZGdldHMuY29udmVyc2F0aW9uTGlzdC5jb252ZXJzYXRpb25zTG9hZGVkDQogICAgICAgIHRvdGFsQ291bnQNCgl3aWRnZXRzLmNvbnZlcnNhdGlvbkxpc3QuY29udmVyc2F0aW9uc0VtcHR5DQpTdWJzY3JpYmVzIHRvDQogICAgd2lkZ2V0cy5jb252ZXJzYXRpb24uY29udmVyc2F0aW9uTG9hZGVkDQogICAgICAgIHN1YmplY3QNCiAgICAgICAgY29udmVyc2F0aW9uSWQNCiAgICB3aWRnZXRzLmNvbnZlcnNhdGlvbi5tZXNzYWdlQWRkZWQNCiAgICAgICAgY29udmVyc2F0aW9uSWQNCiAgICB3aWRnZXRzLmNvbnZlcnNhdGlvbkJhbm5lci5jb252ZXJzYXRpb25EZWxldGVkDQogICAgICAgIGNvbnZlcnNhdGlvbklkDQogICAgbm90aWZpY2F0aW9uLnJhaXNlZCAocGxhdGZvcm0gZXZlbnQpDQogICAgY2hhdC5tZXNzYWdlUmVjZWl2ZWQgKHBsYXRmb3JtIGV2ZW50KQ0KICovDQooZnVuY3Rpb24oJCwgZ2xvYmFsLCB1bmRlZikgew0KDQogICAgJC50ZWxsaWdlbnQgPSAkLnRlbGxpZ2VudCB8fCB7fTsNCiAgICAkLnRlbGxpZ2VudC5ldm9sdXRpb24gPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24gfHwge307DQogICAgJC50ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cyB8fCB7fTsNCg0KICAgIHZhciBtZXNzYWdpbmcgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLA0KICAgICAgICBtZXNzYWdlcyA9IHsNCiAgICAgICAgICAgIC8vIHB1Ymxpc2hlcyBnbG9iYWxseQ0KICAgICAgICAgICAgY29udmVyc2F0aW9uc0xvYWRlZDogJ3dpZGdldHMuY29udmVyc2F0aW9uTGlzdC5jb252ZXJzYXRpb25zTG9hZGVkJywNCgkJCWNvbnZlcnNhdGlvbnNFbXB0eTogJ3dpZGdldHMuY29udmVyc2F0aW9uTGlzdC5jb252ZXJzYXRpb25zRW1wdHknLA0KDQogICAgICAgICAgICAvLyBzdWJzY3JpYmVzIGdsb2JhbGx5DQogICAgICAgICAgICBjb252ZXJzYXRpb25Mb2FkZWQ6ICd3aWRnZXRzLmNvbnZlcnNhdGlvbi5jb252ZXJzYXRpb25Mb2FkZWQnLA0KICAgICAgICAgICAgbWVzc2FnZUFkZGVkOiAnd2lkZ2V0cy5jb252ZXJzYXRpb24ubWVzc2FnZUFkZGVkJywNCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbkRlbGV0ZWQ6ICd3aWRnZXRzLmNvbnZlcnNhdGlvbkJhbm5lci5jb252ZXJzYXRpb25EZWxldGVkJywNCiAgICAgICAgICAgIG5vdGlmaWNhdGlvblJhaXNlZDogJ25vdGlmaWNhdGlvbi5yYWlzZWQnLA0KICAgICAgICAgICAgY2hhdE1lc3NhZ2VSZWNlaXZlZDogJ2NoYXQubWVzc2FnZVJlY2VpdmVkJywNCg0KICAgICAgICAgICAgLy8gbG9jYWwNCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbkxpc3RQYWdlZDogJ3dpZGdldHMuY29udmVyc2F0aW9uTGlzdC52aWV3LnBhZ2VkJw0KICAgICAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBNb2RlbA0KICAgICAqIENvbnN0cnVjdG9yOg0KICAgICAqICAgY29udmVyc2F0aW9uTGlzdFVybA0KICAgICAqIE1ldGhvZHM6DQogICAgICogICBsaXN0KHBhZ2VJbmRleCkNCiAgICAgKiBwdWJsaXNoZXM6DQogICAgICogICB3aWRnZXRzLmNvbnZlcnNhdGlvbkxpc3QuY29udmVyc2F0aW9uc0xvYWRlZA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIE1vZGVsKG9wdGlvbnMpIHsNCiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsNCiAgICB9DQogICAgTW9kZWwucHJvdG90eXBlLmxpc3QgPSBmdW5jdGlvbihwYWdlSW5kZXgpIHsNCiAgICAgICAgcmV0dXJuICQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoew0KICAgICAgICAgICAgdXJsOiB0aGlzLm9wdGlvbnMuY29udmVyc2F0aW9uTGlzdFVybCwNCiAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IHBhZ2VJbmRleCB8fCAwDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICB9KS5waXBlKGZ1bmN0aW9uKHJlc3BvbnNlKSB7DQogICAgICAgICAgICB2YXIgciA9ICQocmVzcG9uc2UpOw0KICAgICAgICAgICAgdmFyIG1ldGEgPSByLmZpbHRlcignLmhpZGRlbi5tZXRhJykucmVtb3ZlKCk7DQogICAgICAgICAgICBpZihtZXRhKSB7DQoJCQkJdmFyIGNvdW50ID0gcGFyc2VJbnQobWV0YS5kYXRhKCd0b3RhbGNvdW50JyksIDEwKTsNCgkJCQltZXNzYWdpbmcucHVibGlzaChtZXNzYWdlcy5jb252ZXJzYXRpb25zTG9hZGVkLCB7DQoJCQkJCXRvdGFsQ291bnQ6IGNvdW50DQoJCQkJfSk7DQoJCQkJaWYgKGNvdW50ID09IDApIHsNCgkJCQkJbWVzc2FnaW5nLnB1Ymxpc2gobWVzc2FnZXMuY29udmVyc2F0aW9uc0VtcHR5KTsNCgkJCQl9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcjsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIC8qDQogICAgICogVmlldw0KICAgICAqIENvbnN0cnVjdG9yOg0KICAgICAqICAgdmlldw0KICAgICAqIFJhaXNlcyBFdmVudHMNCiAgICAgKiAgIGNvbnZlcnNhdGlvbkxpc3QucGFnZWQgKHBhZ2VJbmRleCkNCiAgICAgKiBNZXRob2RzDQogICAgICogICByZW5kZXIocmVuZGVyZWRDb252ZXJzYXRpb25zKQ0KICAgICAqICAgYXBwZW5kKHJlbmRlcmVkQ29udmVyc2F0aW9ucykNCiAgICAgKiAgIHJlbW92ZUNvbnZlcnNhdGlvbihjb252ZXJzYXRpb25JZCkNCiAgICAgKiAgIHZpZXdpbmcoY29udmVyc2F0aW9uSWQpDQogICAgICogICBzY2FsZSgpDQogICAgICovDQogICAgdmFyIFZpZXcgPSAoZnVuY3Rpb24oKXsNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgdmlldzogJycsDQogICAgICAgICAgICB3cmFwcGVyOiAnJw0KICAgICAgICB9Ow0KDQogICAgICAgIC8vIGRldGVybWluZSBpZiB0aGlzIGNvbnRlbnQgaXMgZW5vdWdoIHRvIGNhdXNlIHNjcm9sbGluZw0KICAgICAgICAvLyBpZiBub3QsIHRyeSBhc2tpbmcgZm9yIG1vcmUgcGFnZXMgdW50aWwgaXQgZG9lcyBvciBtYXggYXR0ZW1wdHMgcmVhY2hlZA0KICAgICAgICBmdW5jdGlvbiBwYWdlVW50aWxTY3JvbGxzKGNvbnRleHQpIHsNCiAgICAgICAgICAgIGlmKCFjb250ZXh0Lmhhc01vcmUpDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgdmFyIGNvbnRlbnRIZWlnaHQgPSAwOw0KICAgICAgICAgICAgY29udGV4dC52aWV3LmZpbmQoJ2xpLmNvbnRlbnQtaXRlbS5jb252ZXJzYXRpb24nKS5lYWNoKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgY29udGVudEhlaWdodCArPSAkKHRoaXMpLmhlaWdodCgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBpZihjb250ZW50SGVpZ2h0IDwgY29udGV4dC52aWV3LmhlaWdodCgpICYmIGNvbnRleHQucGFnZWRDb250ZW50QXR0ZW1wdHMgPCAxMCkgew0KICAgICAgICAgICAgICAgIGNvbnRleHQucGFnZWRDb250ZW50QXR0ZW1wdHMrKzsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnBhZ2VJbmRleCsrOw0KICAgICAgICAgICAgICAgIG1lc3NhZ2luZy5wdWJsaXNoKG1lc3NhZ2VzLmNvbnZlcnNhdGlvbkxpc3RQYWdlZCwgew0KICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IGNvbnRleHQucGFnZUluZGV4DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnRleHQucGFnZWRDb250ZW50QXR0ZW1wdHMgPSAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRXZlbnRzKGNvbnRleHQpIHsNCiAgICAgICAgICAgIC8vIGluZmluaXRlIHBhZ2luZyB3aGVuIHNjcm9sbGluZyBkb3duDQogICAgICAgICAgICBjb250ZXh0LnZpZXcub24oJ3Njcm9sbGVuZCcsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgaWYoIWNvbnRleHQuaGFzTW9yZSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGNvbnRleHQucGFnZUluZGV4Kys7DQogICAgICAgICAgICAgICAgbWVzc2FnaW5nLnB1Ymxpc2gobWVzc2FnZXMuY29udmVyc2F0aW9uTGlzdFBhZ2VkLCB7DQogICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogY29udGV4dC5wYWdlSW5kZXgNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBjb250ZXh0LnZpZXcub24oJ2NsaWNrJywgJ2xpLmNvbnZlcnNhdGlvbicsIGZ1bmN0aW9uKGUpew0KICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICAvLyB0cmVhdCBpdCBhcyBpZiBpdCB3YXMgbGlrZSBjbGlja2luZyB0aGUgdGl0bGUNCiAgICAgICAgICAgICAgICB2YXIgY29udmVyc2F0aW9uVXJsID0gJCh0aGlzKS5kYXRhKCdjb252ZXJzYXRpb251cmwnKS5yZXBsYWNlKC9cPy8sJyMnKTsNCiAgICAgICAgICAgICAgICBnbG9iYWwubG9jYXRpb24gPSBjb252ZXJzYXRpb25Vcmwuc3Vic3RyKGNvbnZlcnNhdGlvblVybC5pbmRleE9mKCcjJykpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlUmVzaXplKGNvbnRleHQpIHsNCiAgICAgICAgICAgIGNvbnRleHQudmlldy5jc3MoeyBoZWlnaHQ6IGNvbnRleHQud3JhcHBlci5oZWlnaHQoKSB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICB2YXIgY29udGV4dCA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgb3B0aW9ucyB8fCB7fSk7DQogICAgICAgICAgICBjb250ZXh0LnBhZ2VJbmRleCA9IDA7DQogICAgICAgICAgICBjb250ZXh0LnZpZXcgPSAkKGNvbnRleHQudmlldyk7DQoNCiAgICAgICAgICAgIC8vIHNldCB1cCBldmVudCBoYW5kbGVycw0KICAgICAgICAgICAgaGFuZGxlRXZlbnRzKGNvbnRleHQpOw0KDQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIC8vIHJlcGxhY2VzIGFsbCB0aGUgY29udGVudCBvZiB0aGUgdmlldw0KICAgICAgICAgICAgICAgIC8vIGlmIG5vIGNvbnRlbnQgcGFzc2VkLCByZS1pbml0aWF0ZXMgd2l0aCB0aGUgdmlldydzIGN1cnJlbnQgY29udGVudHMNCg0KICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24ocmVuZGVyZWRDb252ZXJzYXRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZVJlc2l6ZShjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5wYWdlSW5kZXggPSAwOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0Lmhhc01vcmUgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnBhZ2VkQ29udGVudEF0dGVtcHRzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgaWYocmVuZGVyZWRDb252ZXJzYXRpb25zKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC52aWV3Lmh0bWwocmVuZGVyZWRDb252ZXJzYXRpb25zKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5oYXNNb3JlID0gY29udGV4dC52aWV3LmZpbmQoJ2xpLmNvbnRlbnQtaXRlbS5jb252ZXJzYXRpb246bGFzdCcpLmRhdGEoJ2hhc21vcmUnKTsNCiAgICAgICAgICAgICAgICAgICAgcGFnZVVudGlsU2Nyb2xscyhjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGFwcGVuZDogZnVuY3Rpb24ocmVuZGVyZWRDb252ZXJzYXRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgICQocmVuZGVyZWRDb252ZXJzYXRpb25zKS5lYWNoKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGFwcGVuZCBjb252ZXJzYXRpb25zIHRvIHRoZSBsaXN0IHdoaWNoIGFyZW4ndCBhbHJlYWR5IGluIHRoZSBsaXN0DQogICAgICAgICAgICAgICAgICAgICAgICBpZigkKHRoaXMuaWQpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQudmlldy5hcHBlbmQodGhpcyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0Lmhhc01vcmUgPSBjb250ZXh0LnZpZXcuZmluZCgnbGkuY29udGVudC1pdGVtLmNvbnZlcnNhdGlvbjpsYXN0JykuZGF0YSgnaGFzbW9yZScpOw0KICAgICAgICAgICAgICAgICAgICBwYWdlVW50aWxTY3JvbGxzKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgcmVtb3ZlQ29udmVyc2F0aW9uOiBmdW5jdGlvbihjb252ZXJzYXRpb25JZCkgew0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXcuZmluZCgnbGlbZGF0YS1jb252ZXJzYXRpb25pZD0iJyArIGNvbnZlcnNhdGlvbklkICsgJyJdJykucmVtb3ZlKCk7DQoJCQkJCWlmIChjb250ZXh0LnZpZXcuZmluZCgnbGkuY29udGVudC1pdGVtLmNvbnZlcnNhdGlvbicpLmxlbmd0aCA9PSAwKSB7DQoJCQkJCQltZXNzYWdpbmcucHVibGlzaChtZXNzYWdlcy5jb252ZXJzYXRpb25zRW1wdHkpOw0KCQkJCQl9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB2aWV3aW5nOiBmdW5jdGlvbihjb252ZXJzYXRpb25JZCkgew0KICAgICAgICAgICAgICAgICAgICBpZihjb250ZXh0LnZpZXcuZmluZCgnbGk6Zmlyc3QnKS5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC52aWV3LmZpbmQoJ2xpLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJykNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC52aWV3LmZpbmQoJ2xpW2RhdGEtY29udmVyc2F0aW9uaWQ9IicgKyBjb252ZXJzYXRpb25JZCArICciXScpLmFkZENsYXNzKCdzZWxlY3RlZCcpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQudmlldy5maW5kKCdsaVtkYXRhLWNvbnZlcnNhdGlvbmlkPSInICsgY29udmVyc2F0aW9uSWQgKyAnIl0nKS5yZW1vdmVDbGFzcygndW5yZWFkJykNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzY2FsZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZVJlc2l6ZShjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICB9Ow0KICAgIH0pKCk7DQoNCiAgICBmdW5jdGlvbiByZWZyZXNoKGNvbnRleHQpIHsNCiAgICAgICAgY29udGV4dC5tb2RlbC5saXN0KCkuZG9uZShmdW5jdGlvbihyZW5kZXJlZENvbnZlcnNhdGlvbnMpew0KICAgICAgICAgICAgY29udGV4dC52aWV3LnJlbmRlcihyZW5kZXJlZENvbnZlcnNhdGlvbnMpOw0KICAgICAgICAgICAgaWYoY29udGV4dC5jb252ZXJzYXRpb25JZCkNCiAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXcudmlld2luZyhjb250ZXh0LmNvbnZlcnNhdGlvbklkKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3Vic2NyaWJlVG9NZXNzYWdlcyhjb250ZXh0KSB7DQogICAgICAgIG1lc3NhZ2luZy5zdWJzY3JpYmUobWVzc2FnZXMuY29udmVyc2F0aW9uTGlzdFBhZ2VkLCBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICBpZihjb250ZXh0LmxvYWRpbmdDb252ZXJzYXRpb25zKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIGNvbnRleHQubG9hZGluZ0NvbnZlcnNhdGlvbnMgPSB0cnVlOw0KDQogICAgICAgICAgICBjb250ZXh0Lm1vZGVsLmxpc3QoZGF0YS5wYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24ocGFnZUNvbnRlbnQpew0KICAgICAgICAgICAgICAgIGNvbnRleHQubG9hZGluZ0NvbnZlcnNhdGlvbnMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXcuYXBwZW5kKHBhZ2VDb250ZW50KTsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXcudmlld2luZyhjb250ZXh0LmNvbnZlcnNhdGlvbklkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgbWVzc2FnaW5nLnN1YnNjcmliZShtZXNzYWdlcy5jb252ZXJzYXRpb25EZWxldGVkLCBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICBjb250ZXh0LnZpZXcucmVtb3ZlQ29udmVyc2F0aW9uKGRhdGEuY29udmVyc2F0aW9uSWQpOw0KICAgICAgICB9KTsNCiAgICAgICAgbWVzc2FnaW5nLnN1YnNjcmliZShtZXNzYWdlcy5jb252ZXJzYXRpb25Mb2FkZWQsIGZ1bmN0aW9uKGRhdGEpIHsNCiAgICAgICAgICAgIGNvbnRleHQuY29udmVyc2F0aW9uSWQgPSBkYXRhLmNvbnZlcnNhdGlvbklkOw0KICAgICAgICAgICAgZ2xvYmFsLmNsZWFySW50ZXJ2YWwoY29udGV4dC5zZXRWaWV3aW5nSW50ZXJ2YWwpOw0KICAgICAgICAgICAgY29udGV4dC5zZXRWaWV3aW5nSW50ZXJ2YWxNYXggPSAwDQogICAgICAgICAgICBjb250ZXh0LnNldFZpZXdpbmdJbnRlcnZhbCA9IGdsb2JhbC5zZXRJbnRlcnZhbChmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0Vmlld2luZ0ludGVydmFsTWF4Kys7DQogICAgICAgICAgICAgICAgaWYoY29udGV4dC52aWV3LnZpZXdpbmcoZGF0YS5jb252ZXJzYXRpb25JZCkgfHwgY29udGV4dC5zZXRWaWV3aW5nSW50ZXJ2YWxNYXggPiA0MCkgew0KICAgICAgICAgICAgICAgICAgICBnbG9iYWwuY2xlYXJJbnRlcnZhbChjb250ZXh0LnNldFZpZXdpbmdJbnRlcnZhbCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0Vmlld2luZ0ludGVydmFsTWF4ID0gMA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIDUwKTsNCiAgICAgICAgfSk7DQogICAgICAgIG1lc3NhZ2luZy5zdWJzY3JpYmUobWVzc2FnZXMubWVzc2FnZUFkZGVkLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHJlZnJlc2goY29udGV4dCk7DQogICAgICAgIH0pOw0KICAgICAgICBtZXNzYWdpbmcuc3Vic2NyaWJlKG1lc3NhZ2VzLm5vdGlmaWNhdGlvblJhaXNlZCwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZWZyZXNoKGNvbnRleHQpOw0KICAgICAgICB9KTsNCiAgICAgICAgbWVzc2FnaW5nLnN1YnNjcmliZShtZXNzYWdlcy5jaGF0TWVzc2FnZVJlY2VpdmVkLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHJlZnJlc2goY29udGV4dCk7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN1YnNjcmliZVRvRXZlbnRzKGNvbnRleHQpIHsNCiAgICAgICAgJChnbG9iYWwpLm9uKCdyZXNpemVkJywgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHJlc2l6ZVdyYXBwZXIoY29udGV4dCk7DQogICAgICAgICAgICBjb250ZXh0LnZpZXcuc2NhbGUoKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgdmFyIHJlc2l6ZVdyYXBwZXIgPSBmdW5jdGlvbihjb250ZXh0KSB7DQogICAgICAgIHZhciB0b3RhbCA9IDA7DQogICAgICAgIA0KICAgICAgICAkKCcuaGVhZGVyLWZyYWdtZW50cycpLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgdCA9ICQodGhpcykub2Zmc2V0KCkudG9wOw0KICAgICAgICAgICAgaWYgKHQgPiB0b3RhbCkgew0KICAgICAgICAgICAgICAgIHRvdGFsID0gdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkNCg0KICAgICAgICAkKCcuaGVhZGVyLWZyYWdtZW50cy1oZWFkZXIsIC5oZWFkZXItZnJhZ21lbnRzLCAuaGVhZGVyLWZyYWdtZW50cy1mb290ZXInKS5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdG90YWwgKz0gJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29udGV4dC53cmFwcGVyLmhlaWdodCgoJChnbG9iYWwpLmlubmVySGVpZ2h0KCkgLSB0b3RhbCkgKiAuOTkpOw0KICAgIH07DQoNCiAgICAkLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cy5jb252ZXJzYXRpb25MaXN0ID0gew0KICAgICAgICByZWdpc3RlcjogZnVuY3Rpb24oY29udGV4dCkgew0KICAgICAgICAgICAgLy8gY2FwdHVyZSB1aSByZWZlcmVuY2VzDQogICAgICAgICAgICBjb250ZXh0LndyYXBwZXIgPSAkKGNvbnRleHQud3JhcHBlcik7DQogICAgICAgICAgICBjb250ZXh0LmNvbnZlcnNhdGlvbkxpc3QgPSAkKGNvbnRleHQuY29udmVyc2F0aW9uTGlzdCk7DQoNCiAgICAgICAgICAgIC8vIG1vZGVsDQogICAgICAgICAgICBjb250ZXh0Lm1vZGVsID0gbmV3IE1vZGVsKHsNCiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25MaXN0VXJsOiBjb250ZXh0LmNvbnZlcnNhdGlvbkxpc3RVcmwNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAvLyB2aWV3DQogICAgICAgICAgICBjb250ZXh0LnZpZXcgPSBuZXcgVmlldyh7DQogICAgICAgICAgICAgICAgdmlldzogY29udGV4dC5jb252ZXJzYXRpb25MaXN0LA0KICAgICAgICAgICAgICAgIHdyYXBwZXI6IGNvbnRleHQud3JhcHBlcg0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIC8vIGJpbmRpbmdzDQogICAgICAgICAgICBzdWJzY3JpYmVUb0V2ZW50cyhjb250ZXh0KTsNCiAgICAgICAgICAgIHN1YnNjcmliZVRvTWVzc2FnZXMoY29udGV4dCk7DQoNCiAgICAgICAgICAgIC8vIHN0YXJ0DQogICAgICAgICAgICByZXNpemVXcmFwcGVyKGNvbnRleHQpOw0KICAgICAgICAgICAgY29udGV4dC52aWV3LnJlbmRlcigpOw0KICAgICAgICAgICAgcmVmcmVzaChjb250ZXh0KTsNCiAgICAgICAgfQ0KICAgIH07DQp9KGpRdWVyeSwgd2luZG93KSk7DQo=</file>
		</files>
	</scriptedContentFragment>
</scriptedContentFragments>