<scriptedContentFragments>
	<scriptedContentFragment name="${resource:Core_QuickPost_Name}" version="10.1.8.10498" description="${resource:Core_QuickPost_Description}" instanceIdentifier="9d82087eeb43486681045fdf172659e9" theme="" isCacheable="true" varyCacheByUser="true" showHeaderByDefault="false" cssClass="quick-post">
		<contentScript><![CDATA[#set ($group = false)
#set ($group = $core_v2_group.Current)
#set ($accessingUser = $core_v2_user.Accessing)
#set ($uploadContextId = $core_v2_uploadedFile.CreateContextId())
#set ($groupSelectorTemplateId = 'telligent.evolution.widgets.quickPost.groupSelector')
#set ($groupSelectorGroupsTemplateId = 'telligent.evolution.widgets.quickPost.groupSelectorGroups')
#set ($groupSelectorId = $core_v2_widget.UniqueId('groupSelector'))

$core_v2_widget.ExecuteFile('load-group-selection-mode.vm')

$core_v2_widget.ExecuteFile('detect-status-enabled.vm')
#if (!$enableStatus)
	$core_v2_widget.Hide()
#end

<fieldset>
	<ul class="field-list">
		#if ($groupSelectionMode == 'targetable')
			<li class="field-item post-container">
				<span class="field-item-input">
					<div class="group-selector ui-tip"
						data-tip="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('ShareWith'))"
						id="$core_v2_encoding.HtmlAttributeEncode($groupSelectorId)">
						<span class="cancel-selection">
							<a class="ui-tip" data-tip="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('ShareWithSite'))" href="#">$core_v2_language.GetResource('ShareWithSite')</a>
						</span>
						<span class="group-avatar"></span>
						<span class="group-name">
							<a href="#" class="internal-link group">
								$core_v2_language.GetResource('ShareWithSite')
							</a>
						</span>
					</div>
				</span>
			</li>
		#end

        <li class="field-item post-type">        
            $core_v2_widget.ExecuteFile('new-post-links.vm')
        </li>

		#if ($group.ParentGroupId == -1 && (!$statusPromptResourceName || $statusPromptResourceName == ""))
        	#set ($statusPromptResourceName = "${}{resource:CF_QuickPost_DefaultStatusPrompt}")
        	#set ($statusPromptResourceName = $statusPromptResourceName.Replace("{}", ""))
        	$core_v2_widget.SetStringValue("statusPrompt", $statusPromptResourceName)
        #elseif (!$statusPromptResourceName || $statusPromptResourceName == "")
        	#set ($statusPromptResourceName = "${}{resource:CF_QuickPost_DefaultGroupStatus}")
        	#set ($statusPromptResourceName = $statusPromptResourceName.Replace("{}", ""))
        	$core_v2_widget.SetStringValue("statusPrompt", $statusPromptResourceName)
        #end
        #set ($statusMessagePrompt = $core_v2_encoding.HtmlDecode($core_v2_widget.ApplyTokens($statusPromptResourceName)))
    	<li class="field-item status">
    		#set($editorPrefix = $core_v2_widget.ExecuteFile('editor-prefix.vm'))
    		<span #if ($core_v2_user.IsRegistered($accessingUser.Id)) $core_v2_tourTip.Render($core_v2_language.GetResource('TourTip'), "%{ CssClass = 'field-item-input' }") #else class="field-item-input" #end >
    			$core_v2_submittableEditor.Render('ActivityMessageReplyBody', "function() { jQuery.telligent.evolution.widgets.quickPost.submit('$core_v2_widget.WrapperElementId'); }", "%{ ContentTypeId = $core_v2_statusMessage.ContentTypeId, EnterToSubmitPrompt = $core_v2_language.GetResource('EnterToSubmitPrompt'), Height = '20px', SubmitLabel = $core_v2_language.GetResource('SubmitLabel'), Width = '100%', BeforeHtml = $editorPrefix, Placeholder = $statusMessagePrompt, AutoResize = 'True' }")
    		</span>
    		<span class="field-item-input preview" style="display: none;"></span>
    	</li>
	</ul>
</fieldset>

#registerEndOfPageHtml('telligent.evolution.widgets.quickPost')
	<script type="text/javascript" src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('ui.js'))"></script>
	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($groupSelectorTemplateId)">
		<div>
			<div class="group-selector-popup">
				<input type="text" class="search" placeholder="$core_v2_language.GetResource('SearchGroups')" />
				<div class="groups"></div>
			</div>
		</div>
	</script>
	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($groupSelectorGroupsTemplateId)">
		<% if(groups && groups.length > 0) { %>
			<ul class="navigation-list">
				<% foreach(groups, function(group){ %>
					<li class="navigation-list-item">
						<span class="group-avatar">
							<%= group.avatarHtml %>
						</span>
						<span class="group-name">
							<a href="#" class="internal-link" data-containerid="<%= group.id %>" data-name="<%= group.name %>"><%= group.name %></a>
						</span>
					</li>
				<% }); %>
			</ul>
		<% } else { %>
			<div class="no-match">$core_v2_language.GetResource('NoMatching')</div>
		<% } %>
	</script>
#end
#registerEndOfPageHtml()
	<script type="text/javascript">
	jQuery(function(){
		jQuery.telligent.evolution.widgets.quickPost.register({
			wrapperSelector: '#$core_v2_encoding.JavascriptEncode($core_v2_widget.WrapperElementId)',
			editor: {
			  getContent: function() { return $core_v2_submittableEditor.GetContentScript('ActivityMessageReplyBody') },
			  setContent: function(c) { $core_v2_submittableEditor.GetUpdateContentScript('ActivityMessageReplyBody', 'c') },
			  onChange: function(f) { $core_v2_submittableEditor.GetAttachOnKeyDownScript('ActivityMessageReplyBody', 'f') }
			},
			addUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('add-status.vm'))',
			successMessage: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('CF_Core_QuickPost_PostSuccess'))',
			containerId: '$group.ContainerId',
			uploadFileUrl : '$core_v2_encoding.JavascriptEncode($core_v2_uploadedFile.GetUploadUrl($uploadContextId))',
			uploadContextId : '$core_v2_encoding.JavascriptEncode($uploadContextId)',
			previewAttachmentUrl: "$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('preview-attachment.vm'))",
			loadFormUrl: "$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('load-status-form.vm'))",
			progressMessage: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Uploading'))',
			changeFileMessage: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('ChangeFile'))',
			uploadFileMessage: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('StatusMessage_UploadFile'))',
			groupSelectorTemplateId: '$core_v2_encoding.JavascriptEncode($groupSelectorTemplateId)',
			groupSelectorGroupsTemplateId: '$core_v2_encoding.JavascriptEncode($groupSelectorGroupsTemplateId)',
			groupSelectorId: '#$core_v2_encoding.JavascriptEncode($groupSelectorId)',
			applicationLinkMessageName: '$core_v2_encoding.JavascriptEncode("widget.${core_v2_widget.WrapperElementId}.applicationLink")',
			storeUrl: "$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('store-temp-data.vm'))",
			groupSearchUrl: "$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('search-groups.vm'))",
			groupBookmarkAndMembershipUrl: "$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('prefill-groups.vm'))",
			shareWithSite: '$core_v2_language.GetResource('ShareWithSite')',
			statusMessageContentTypeId: '$core_v2_statusMessage.ContentTypeId.ToString()',
			rootContainerId: '$core_v2_group.Root.ContainerId'
			#if ($groupSelectionMode == 'targetable' && $group.Id != $core_v2_group.Root.Id)
				,initialName: '$core_v2_encoding.JavascriptEncode($group.Name)',
				initialContainerId: '$group.ContainerId',
				initialAvatarHtml: '$core_v2_encoding.JavascriptEncode($core_v2_ui.GetResizedImageHtml($group.AvatarUrl, 16, 16, "%{ ResizeMethod = 'ZoomAndCrop' }"))'
			#end
		});
	});
	</script>
#end
]]></contentScript>
		<headerScript><![CDATA[
	$core_v2_widget.ApplyTokens($core_v2_widget.GetStringValue('fragmentHeader', '${resource:Core_QuickPost_Name}'))
]]></headerScript>
		<configuration><![CDATA[	<propertyGroup id="options" resourceName="Options">
		<property id="fragmentHeader" resourceName="CF_Title" dataType="string" defaultValue="${resource:Core_QuickPost_Name}" controlType="Telligent.Evolution.Controls.ContentFragmentTokenStringControl, Telligent.Evolution.Platform" />
		<property id="statusPrompt" resourceName="CF_QuickPost_StatusPrompt" dataType="string" defaultValue="" controlType="Telligent.Evolution.Controls.ContentFragmentTokenStringControl, Telligent.Evolution.Platform" />
		<property id="groupSelectionMode" resourceName="GroupSelectionMode" dataType="string" defaultValue="">
			<propertyValue value="targetable" resourceName="GroupSelectionMode_Enabled" />
			<propertyValue value="current" resourceName="GroupSelectionMode_Disabled" />
		</property>
	</propertyGroup>
]]></configuration>
		<languageResources><language key="en-us">
  <resource name="cancel">Cancel</resource>
  <resource name="CF_Core_QuickPost_PostSuccess">Your message was published successfully. </resource>
  <resource name="CF_QuickPost_DefaultGroupStatus">Leave a message for the community.</resource>
  <resource name="CF_QuickPost_DefaultStatusPrompt">Leave a message</resource>
  <resource name="CF_QuickPost_StatusPrompt">Status Message Prompt</resource>
  <resource name="CF_Title">Widget Title</resource>
  <resource name="ChangeFile">Change file</resource>
  <resource name="Core_QuickPost_Description">Displays a form for creating a status message for the site or current community.</resource>
  <resource name="Core_QuickPost_Name">Quick Post</resource>
  <resource name="EnterToSubmitPrompt">Enter to post</resource>
  <resource name="GroupSelectionMode">Community Selection</resource>
  <resource name="GroupSelectionMode_Disabled">Current</resource>
  <resource name="GroupSelectionMode_Enabled">Targetable</resource>
  <resource name="more">More</resource>
  <resource name="NoMatching">No matching communities</resource>
  <resource name="Options">Options</resource>
  <resource name="Post">Post</resource>
  <resource name="Posting">…</resource>
  <resource name="RemoveFile">Remove file</resource>
  <resource name="SearchGroups">Search Communities...</resource>
  <resource name="ShareWith">Share With</resource>
  <resource name="ShareWithSite">Share with everyone</resource>
  <resource name="statusMessage">Status Message</resource>
  <resource name="StatusMessage_UploadFile">Add file</resource>
  <resource name="SubmitLabel">Post</resource>
  <resource name="TourTip">Add your own status message for the community or comment on someone else's message. If you are new to the community, why not introduce yourself?</resource>
  <resource name="Uploading">Uploading ({0}%)...</resource>
</language>
<language key="zh-cn">
  <resource name="cancel">取消</resource>
  <resource name="CF_Core_QuickPost_PostSuccess">您的消息已成功发布。</resource>
  <resource name="CF_QuickPost_DefaultGroupStatus">给社区发送消息。</resource>
  <resource name="CF_QuickPost_DefaultStatusPrompt">发送消息</resource>
  <resource name="CF_QuickPost_StatusPrompt">状态消息提示</resource>
  <resource name="CF_Title">小组件标题</resource>
  <resource name="ChangeFile">更改文件</resource>
  <resource name="Core_QuickPost_Description">显示用于为网站或当前社区创建状态消息的窗体。</resource>
  <resource name="Core_QuickPost_Name">快速发布</resource>
  <resource name="EnterToSubmitPrompt"></resource>
  <resource name="GroupSelectionMode">社区选择</resource>
  <resource name="GroupSelectionMode_Disabled">当前</resource>
  <resource name="GroupSelectionMode_Enabled">可定位</resource>
  <resource name="more">更多</resource>
  <resource name="NoMatching">没有匹配的社区</resource>
  <resource name="Options">选项</resource>
  <resource name="Post">文章</resource>
  <resource name="Posting">…</resource>
  <resource name="RemoveFile">移除文件</resource>
  <resource name="SearchGroups">搜索社区...</resource>
  <resource name="ShareWith">共享对象</resource>
  <resource name="ShareWithSite">与每个人共享</resource>
  <resource name="statusMessage">状态消息</resource>
  <resource name="StatusMessage_UploadFile">添加文件</resource>
  <resource name="SubmitLabel">发布</resource>
  <resource name="TourTip">添加您自己的关于社区的状态消息或评论某个其他人员的消息。如果您是社区新成员，请向社区介绍您自己。</resource>
  <resource name="Uploading">正在上传({0}%)...</resource>
</language>
<language key="zh-tw">
  <resource name="cancel">取消</resource>
  <resource name="CF_Core_QuickPost_PostSuccess">已成功發佈您的訊息。</resource>
  <resource name="CF_QuickPost_DefaultGroupStatus">針對社群留言。</resource>
  <resource name="CF_QuickPost_DefaultStatusPrompt">留言</resource>
  <resource name="CF_QuickPost_StatusPrompt">狀態訊息提示</resource>
  <resource name="CF_Title">Widget 標題</resource>
  <resource name="ChangeFile">變更檔案</resource>
  <resource name="Core_QuickPost_Description">顯示用於針對網站或目前社群建立狀態訊息的表單。</resource>
  <resource name="Core_QuickPost_Name">快速貼文</resource>
  <resource name="EnterToSubmitPrompt"></resource>
  <resource name="GroupSelectionMode">社群選取</resource>
  <resource name="GroupSelectionMode_Disabled">目前</resource>
  <resource name="GroupSelectionMode_Enabled">可做為目標</resource>
  <resource name="more">更多</resource>
  <resource name="NoMatching">沒有相符社群</resource>
  <resource name="Options">選項</resource>
  <resource name="Post">貼文</resource>
  <resource name="Posting">…</resource>
  <resource name="RemoveFile">移除檔案</resource>
  <resource name="SearchGroups">搜尋社群...</resource>
  <resource name="ShareWith">分享對象</resource>
  <resource name="ShareWithSite">與所有人分享</resource>
  <resource name="statusMessage">狀態訊息</resource>
  <resource name="StatusMessage_UploadFile">新增檔案</resource>
  <resource name="SubmitLabel">貼文</resource>
  <resource name="TourTip">在社群中新增您自己的狀態訊息，或在別人的訊息中留言。如果您剛加入社群，何不先自我介紹?</resource>
  <resource name="Uploading">上傳中 ({0}%)...</resource>
</language></languageResources>
		<files>
			<file name="add-status.vm">77u/JGNvcmVfdjJfcGFnZS5TZXRDb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpDQoNCiNpZiAoJGNvcmVfdjJfcGFnZS5Jc1Bvc3QpDQoJI3NldCgkY29udGFpbmVySWQgPSAkY29yZV92Ml91dGlsaXR5LlBhcnNlR3VpZCgkY29yZV92Ml9wYWdlLkdldEZvcm1WYWx1ZSgnY29udGFpbmVySWQnKSkpDQoJI3NldCgkbWVzc2FnZUJvZHkgPSAkY29yZV92Ml9wYWdlLkdldEZvcm1WYWx1ZSgnbWVzc2FnZScpKQ0KCSNzZXQoJGdyb3VwID0gZmFsc2UpDQoJI3NldCgkZ3JvdXAgPSAkY29yZV92Ml9ncm91cC5HZXQoIiV7IENvbnRhaW5lcklkID0gJyR7Y29udGFpbmVySWR9J30iKSkNCgkjc2V0KCRmaWxlTmFtZSA9IGZhbHNlKQ0KCSNzZXQoJGZpbGVOYW1lID0gJGNvcmVfdjJfcGFnZS5HZXRGb3JtVmFsdWUoJ2ZpbGVOYW1lJykpDQoJI3NldCgkY29udGV4dElkID0gZmFsc2UpDQoJI3NldCgkY29udGV4dElkID0gJGNvcmVfdjJfcGFnZS5HZXRGb3JtVmFsdWUoJ2NvbnRleHRJZCcpKQ0KCSNzZXQoJG9wdGlvbnMgPSAiJXt9IikNCg0KCSNpZiAoJGZpbGVOYW1lICYmICRmaWxlTmFtZS5sZW5ndGggPiAwICYmICRjb250ZXh0SWQpDQoJCSNzZXQgKCRhdHRhY2hlZEZpbGUgPSAkY29yZV92Ml91cGxvYWRlZEZpbGUuR2V0KCRjb250ZXh0SWQsICRmaWxlTmFtZSkpDQoJCSNpZiAoJGF0dGFjaGVkRmlsZSkNCgkJCSRvcHRpb25zLkFkZCgnQXR0YWNoZWRVcmwnLCAkYXR0YWNoZWRGaWxlLlVybCkNCgkJI2VuZA0KCSNlbmQNCg0KCSNpZiAoJGdyb3VwICYmICRncm91cC5QYXJlbnRHcm91cElkICE9IC0xKQ0KCQkkb3B0aW9ucy5BZGQoJ0dyb3VwSWQnLCAkZ3JvdXAuSWQpDQoJI2VuZA0KDQoJI3NldCAoJG1lc3NhZ2UgPSAkY29yZV92Ml9zdGF0dXNNZXNzYWdlLkNyZWF0ZSgkbWVzc2FnZUJvZHksICRvcHRpb25zKSkNCgkjaWYgKCRtZXNzYWdlLkhhc0Vycm9ycygpKQ0KCQkkY29yZV92Ml9wYWdlLlNlbmRKc29uRXJyb3IoJG1lc3NhZ2UuRXJyb3JzKQ0KCSNlbHNlDQoJCSRjb3JlX3YyX3BhZ2UuU2V0Q29udGVudFR5cGUoJ2FwcGxpY2F0aW9uL2pzb24nKQ0KCQl7ImJvZHkiOiAiJGNvcmVfdjJfZW5jb2RpbmcuSmF2YXNjcmlwdEVuY29kZSgkbWVzc2FnZS5SZW5kZXJlZEJvZHkpIn0NCgkjZW5kDQojZW5k</file>
			<file name="detect-status-enabled.vm">77u/IyMNCiMjIEFzc3VtZXMgJGdyb3VwIHRvIGJlIGluIHNjb3BlLg0KIyMgSW5qZWN0cyBhbiAkZW5hYmxlU3RhdHVzIGJvb2xlYW4gaW50byBzY29wZSBiYXNlZCBvbiBsb2dpYw0KIyMNCg0KI3NldCAoJGVuYWJsZVN0YXR1cyA9IGZhbHNlKQ0KI3NldCAoJGVuYWJsZVN0YXR1cyA9ICRncm91cC5FbmFibGVHcm91cE1lc3NhZ2VzKQ0KI2lmICgkZ3JvdXAuR3JvdXBUeXBlID09ICdKb2lubGVzcycpDQoJI3NldCAoJGVuYWJsZVN0YXR1cyA9ICRlbmFibGVTdGF0dXMgJiYgJGNvcmVfdjJfdXNlci5Jc1JlZ2lzdGVyZWQoJGFjY2Vzc2luZ1VzZXIuSWQpKQ0KI2Vsc2VpZiAoJGVuYWJsZVN0YXR1cykNCgkjc2V0ICgkZW5hYmxlU3RhdHVzID0gZmFsc2UpDQoJI3NldCAoJGdyb3VwVXNlck1lbWJlciA9IGZhbHNlKQ0KCSNzZXQgKCRncm91cFVzZXJNZW1iZXIgPSAkY29yZV92Ml9ncm91cFVzZXJNZW1iZXIuR2V0KCRncm91cC5JZCwgIiV7IFVzZXJJZCA9ICRhY2Nlc3NpbmdVc2VyLklkIH0iKSkNCgkjaWYgKCRncm91cFVzZXJNZW1iZXIgJiYgKCRncm91cFVzZXJNZW1iZXIuTWVtYmVyc2hpcFR5cGUgPT0gIk93bmVyIiB8fCAkZ3JvdXBVc2VyTWVtYmVyLk1lbWJlcnNoaXBUeXBlID09ICJNYW5hZ2VyIiB8fCAkZ3JvdXBVc2VyTWVtYmVyLk1lbWJlcnNoaXBUeXBlID09ICJNZW1iZXIiKSkNCgkJI3NldCgkZW5hYmxlU3RhdHVzID0gdHJ1ZSkNCgkjZW5kDQojZW5kDQojc2V0ICgkZW5hYmxlU3RhdHVzID0gJGVuYWJsZVN0YXR1cyAmJiAkY29yZV92Ml9hY3Rpdml0eVN0b3J5VXNlclByZWZlcmVuY2UuR2V0KCRjb3JlX3YyX3N0YXR1c01lc3NhZ2UuU3RvcnlUeXBlSWQpLklzTG9nZ2luZ0VuYWJsZWQpDQo=</file>
			<file name="editor-prefix.vm">PGEgaHJlZj0iIyIgY2xhc3M9InVwbG9hZCIgaWQ9IiRjb3JlX3YyX3dpZGdldC5VbmlxdWVJZCgndXBsb2FkJykiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+JGNvcmVfdjJfbGFuZ3VhZ2UuR2V0UmVzb3VyY2UoJ1N0YXR1c01lc3NhZ2VfVXBsb2FkRmlsZScpPC9hPg0KPGEgaHJlZj0iIyIgY2xhc3M9InJlbW92ZSIgaWQ9IiRjb3JlX3YyX3dpZGdldC5VbmlxdWVJZCgncmVtb3ZlJykiIHN0eWxlPSJkaXNwbGF5OiBub25lOyBtYXJnaW4tbGVmdDogMWVtOyI+JGNvcmVfdjJfbGFuZ3VhZ2UuR2V0UmVzb3VyY2UoJ1JlbW92ZUZpbGUnKTwvYT4=</file>
			<file name="load-group-selection-mode.vm">I3NldCAoJGdyb3VwU2VsZWN0aW9uTW9kZSA9IGZhbHNlKQ0KI3NldCAoJGdyb3VwU2VsZWN0aW9uTW9kZSA9ICRjb3JlX3YyX3dpZGdldC5HZXRTdHJpbmdWYWx1ZSgnZ3JvdXBTZWxlY3Rpb25Nb2RlJywgJycpKQ0KI2lmICghJGdyb3VwU2VsZWN0aW9uTW9kZSB8fCAkZ3JvdXBTZWxlY3Rpb25Nb2RlLmxlbmd0aCA9PSAwKQ0KCSNpZiAoJGNvcmVfdjJfdXJscy5DdXJyZW50ID09ICdIb21lJykNCgkJI3NldCAoJGdyb3VwU2VsZWN0aW9uTW9kZSA9ICd0YXJnZXRhYmxlJykNCgkJJGNvcmVfdjJfd2lkZ2V0LlNldFN0cmluZ1ZhbHVlKCdncm91cFNlbGVjdGlvbk1vZGUnLCAkZ3JvdXBTZWxlY3Rpb25Nb2RlKQ0KCSNlbHNlDQoJCSNzZXQgKCRncm91cFNlbGVjdGlvbk1vZGUgPSAnY3VycmVudCcpDQoJCSRjb3JlX3YyX3dpZGdldC5TZXRTdHJpbmdWYWx1ZSgnZ3JvdXBTZWxlY3Rpb25Nb2RlJywgJGdyb3VwU2VsZWN0aW9uTW9kZSkNCgkjZW5kDQojZW5k</file>
			<file name="load-status-form.vm">I3NldCAoJGNvbnRhaW5lcklkID0gJGNvcmVfdjJfdXRpbGl0eS5QYXJzZUd1aWQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCJjb250YWluZXJJZCIpKSkNCiNzZXQgKCRncm91cCA9IGZhbHNlKQ0KI3NldCAoJGdyb3VwID0gJGNvcmVfdjJfZ3JvdXAuR2V0KCIleyBDb250YWluZXJJZCA9ICRjb250YWluZXJJZCB9IikpDQojc2V0ICgkYWNjZXNzaW5nVXNlciA9ICRjb3JlX3YyX3VzZXIuQWNjZXNzaW5nKQ0KJGNvcmVfdjJfd2lkZ2V0LkV4ZWN1dGVGaWxlKCdsb2FkLWdyb3VwLXNlbGVjdGlvbi1tb2RlLnZtJykNCiRjb3JlX3YyX3dpZGdldC5FeGVjdXRlRmlsZSgnZGV0ZWN0LXN0YXR1cy1lbmFibGVkLnZtJykNCg0KJGNvcmVfdjJfcGFnZS5TZXRDb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpDQoNCnsNCiAgICAic3RhdHVzRW5hYmxlZCI6ICNpZigkZW5hYmxlU3RhdHVzKSB0cnVlICNlbHNlIGZhbHNlICNlbmQsDQogICAgIm5ld1Bvc3RMaW5rcyI6ICIkY29yZV92Ml9lbmNvZGluZy5KYXZhc2NyaXB0RW5jb2RlKCRjb3JlX3YyX3dpZGdldC5FeGVjdXRlRmlsZSgnbmV3LXBvc3QtbGlua3Mudm0nKSkiDQp9DQo=</file>
			<file name="new-post-links.vm">I3NldCgkbGlua3MgPSBmYWxzZSkNCiNzZXQoJGxpbmtzID0gJGNvcmVfdjJfZ3JvdXAuTGlzdE5ld1Bvc3RMaW5rcygkZ3JvdXAuSWQpKQ0KI2ZvcmVhY2goJGxpbmsgaW4gJGxpbmtzKQ0KI2JlZm9yZWFsbA0KCQk8ZGl2IGNsYXNzPSJ1aS1saW5rcyBuYXZpZ2F0aW9uLWxpc3QgbGlua3MgI2lmICgkZ3JvdXBTZWxlY3Rpb25Nb2RlID09ICd0YXJnZXRhYmxlJykgd2l0aC1ncm91cC1zZWxlY3RvciAjZW5kIiBkYXRhLWRpcmVjdGlvbj0iaG9yaXpvbnRhbCIgZGF0YS1taW5saW5rcz0iMSIgZGF0YS1tYXhsaW5rcz0iMTAwIj4NCgkJCTx1bCBjbGFzcz0ibmF2aWdhdGlvbi1saXN0Ij4NCgkJCQkjaWYgKCRlbmFibGVTdGF0dXMpDQoJCQkJCTxsaSBjbGFzcz0ibmF2aWdhdGlvbi1saXN0LWl0ZW0iPg0KCQkJCQkJPGEgY2xhc3M9ImludGVybmFsLWxpbmsgYWRkLXBvc3Qgc3RhdHVzIHNlbGVjdGVkIiBkYXRhLW1lc3NhZ2VuYW1lPSJ3aWRnZXQuJHtjb3JlX3YyX3dpZGdldC5XcmFwcGVyRWxlbWVudElkfS5hcHBsaWNhdGlvbkxpbmsiIGhyZWY9IiMiPiRjb3JlX3YyX2xhbmd1YWdlLkdldFJlc291cmNlKCdzdGF0dXNNZXNzYWdlJyk8L2E+DQoJCQkJCTwvbGk+DQoJCQkJI2VuZA0KI2VhY2gNCgkJCQkjaWYgKCEkY29yZV92Ml91dGlsaXR5LklzTWF0Y2goJGxpbmsuQ3NzQ2xhc3MsICIoYXBwbGljYXRpb24pfChncm91cCkiKSkNCgkJCQkJPGxpIGNsYXNzPSJuYXZpZ2F0aW9uLWxpc3QtaXRlbSI+DQoJCQkJCQk8YSBjbGFzcz0iJGxpbmsuQ3NzQ2xhc3MiIGRhdGEtbWVzc2FnZW5hbWU9IndpZGdldC4ke2NvcmVfdjJfd2lkZ2V0LldyYXBwZXJFbGVtZW50SWR9LmFwcGxpY2F0aW9uTGluayIgaHJlZj0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkbGluay5VcmwpIj4kbGluay5MYWJlbDwvYT4NCgkJCQkJPC9saT4NCgkJCQkjZW5kDQojYWZ0ZXJhbGwNCgkJCQk8bGkgY2xhc3M9Im5hdmlnYXRpb24tbGlzdC1pdGVtIj4NCgkJCQkJPGEgY2xhc3M9Im1vcmUiIGhyZWY9IiMiIGRhdGEtbW9yZT4kY29yZV92Ml9sYW5ndWFnZS5HZXRSZXNvdXJjZSgnbW9yZScpPC9hPg0KCQkJCTwvbGk+DQoJCQkJPGxpIGNsYXNzPSJuYXZpZ2F0aW9uLWxpc3QtaXRlbSI+DQoJCQkJCTxhIGhyZWY9IiMiIGRhdGEtY2FuY2VsPiRjb3JlX3YyX2xhbmd1YWdlLkdldFJlc291cmNlKCdjYW5jZWwnKTwvYT4NCgkJCQk8L2xpPg0KCQkJPC91bD4NCgkJPC9kaXY+DQoJPC9saT4NCiNlbmQ=</file>
			<file name="prefill-groups.vm">77u/IyMNCiMjIEN1c3RvbSBHcm91cCBCb29rbWFyayBhbmQgVXNlciBHcm91cHMgY2FsbGJhY2sgdG8gc3VwcG9ydCBhbHNvIHJldHJpZXZpbmcgcmVzaXplZCBBdmF0YXJIdG1sIG92ZXIgd2hhdCdzIHBvc3NpYmxlIGZyb20gUkVTVA0KIyMNCg0KJGNvcmVfdjJfcGFnZS5TZXRDb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpDQoNCiNzZXQgKCRwYWdlU2l6ZSA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCJwYWdlU2l6ZSIpKSkNCiNzZXQgKCRwYWdlSW5kZXggPSAkY29yZV92Ml91dGlsaXR5LlBhcnNlSW50KCRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgicGFnZUluZGV4IikpKQ0KI3NldCAoJHVzZXJJZCA9ICRjb3JlX3YyX3VzZXIuQWNjZXNzaW5nLklkKQ0KI3NldCAoJGltYWdlT3B0aW9ucyA9ICIleyBSZXNpemVNZXRob2QgPSAnWm9vbUFuZENyb3AnIH0iKQ0KDQojc2V0ICgkdXNlckdyb3VwcyA9ICRjb3JlX3YyX2dyb3VwLkxpc3QoIiV7IFBhZ2VJbmRleCA9ICRwYWdlSW5kZXgsIFBhZ2VTaXplID0gJHBhZ2VTaXplLCBVc2VySWQgPSAkdXNlcklkLCBJbmNsdWRlQWxsU3ViR3JvdXBzID0gJ3RydWUnIH0iKSkNCiNzZXQgKCRib29rbWFya2VkR3JvdXBzID0gJGNvcmVfdjJfYm9va21hcmsuTGlzdCgiJXsgVXNlcklkID0gJHVzZXJJZCwgUGFnZUluZGV4ID0gJHBhZ2VJbmRleCwgUGFnZVNpemUgPSAkcGFnZVNpemUsIENvbnRlbnRUeXBlSWRzID0gJGNvcmVfdjJfZ3JvdXAuQ29udGVudFR5cGVJZC5Ub1N0cmluZygpIH0iKSkNCg0Kew0KCSJtZW1iZXJzaGlwcyI6IFsNCiNmb3JlYWNoICgkZ3JvdXAgaW4gJHVzZXJHcm91cHMpDQoJCXsNCgkJCSJuYW1lIjogIiRjb3JlX3YyX2VuY29kaW5nLkphdmFzY3JpcHRFbmNvZGUoJGdyb3VwLk5hbWUpIiwNCgkJCSJpZCI6ICIkY29yZV92Ml9lbmNvZGluZy5KYXZhc2NyaXB0RW5jb2RlKCRncm91cC5Db250YWluZXJJZC5Ub1N0cmluZygpKSIsDQoJCQkiYXZhdGFySHRtbCI6ICIkY29yZV92Ml9lbmNvZGluZy5KYXZhc2NyaXB0RW5jb2RlKCRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGdyb3VwLkF2YXRhclVybCwgMTYsIDE2LCAkaW1hZ2VPcHRpb25zKSkiLA0KCQkJImRhdGUiOiAiJGNvcmVfdjJfZW5jb2RpbmcuSmF2YXNjcmlwdEVuY29kZSgkY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXREYXRlKCRncm91cC5DcmVhdGVkRGF0ZSwgIiV7IEZvcm1hdCA9ICd5eXl5LU1NLWRkVEhIOm1tOnNzJyB9IikpIg0KCQl9DQojYmV0d2Vlbg0KLA0KI2VuZA0KCV0sDQoJImJvb2ttYXJrcyI6IFsNCiNmb3JlYWNoICgkYm9va21hcmsgaW4gJGJvb2ttYXJrZWRHcm91cHMpDQoJCXsNCgkJCSJuYW1lIjogIiRjb3JlX3YyX2VuY29kaW5nLkphdmFzY3JpcHRFbmNvZGUoJGJvb2ttYXJrLkNvbnRlbnQuSHRtbE5hbWUoJ1dlYicpKSIsDQoJCQkiaWQiOiAiJGNvcmVfdjJfZW5jb2RpbmcuSmF2YXNjcmlwdEVuY29kZSgkYm9va21hcmsuQ29udGVudC5Db250ZW50SWQuVG9TdHJpbmcoKSkiLA0KCQkJImF2YXRhckh0bWwiOiAiJGNvcmVfdjJfZW5jb2RpbmcuSmF2YXNjcmlwdEVuY29kZSgkY29yZV92Ml91aS5HZXRSZXNpemVkSW1hZ2VIdG1sKCRib29rbWFyay5Db250ZW50LkF2YXRhclVybCwgMTYsIDE2LCAkaW1hZ2VPcHRpb25zKSkiLA0KCQkJImRhdGUiOiAiJGNvcmVfdjJfZW5jb2RpbmcuSmF2YXNjcmlwdEVuY29kZSgkY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXREYXRlKCRib29rbWFyay5DcmVhdGVkRGF0ZSwgIiV7IEZvcm1hdCA9ICd5eXl5LU1NLWRkVEhIOm1tOnNzJyB9IikpIg0KCQl9DQojYmV0d2Vlbg0KLA0KI2VuZA0KCV0NCn0NCg==</file>
			<file name="preview-attachment.vm">77u/IyMgTG9hZHMgQXR0YWNobWVudCBQcmV2aWV3DQojc2V0KCRtZXNzYWdlQm9keSA9ICRjb3JlX3YyX3BhZ2UuR2V0Rm9ybVZhbHVlKCd3X21lc3NhZ2VCb2R5JykpDQojc2V0KCRncm91cElkID0gJGNvcmVfdjJfdXRpbGl0eS5QYXJzZUludCgkY29yZV92Ml9wYWdlLkdldEZvcm1WYWx1ZSgnd19ncm91cElkJykpKQ0KDQojc2V0ICgkYXR0YWNoZWRGaWxlTmFtZSA9IGZhbHNlKQ0KI3NldCAoJGF0dGFjaGVkRmlsZU5hbWUgPSAkY29yZV92Ml9wYWdlLkdldEZvcm1WYWx1ZSgnd19hdHRhY2hlZEZpbGVOYW1lJykpDQojc2V0ICgkYXR0YWNoZWRGaWxlQ29udGV4dCA9IGZhbHNlKQ0KI3NldCAoJGF0dGFjaGVkRmlsZUNvbnRleHQgPSAkY29yZV92Ml9wYWdlLkdldEZvcm1WYWx1ZSgnd19hdHRhY2hlZEZpbGVDb250ZXh0JykpDQojc2V0ICgkYXR0YWNoZWRVcmwgPSBmYWxzZSkNCiNpZiAoJGF0dGFjaGVkRmlsZU5hbWUubGVuZ3RoID4gMCAmJiAkYXR0YWNoZWRGaWxlQ29udGV4dC5sZW5ndGggPiAwKQ0KICAgICNzZXQgKCRhdHRhY2hlZEZpbGUgPSBmYWxzZSkNCgkjc2V0ICgkYXR0YWNoZWRGaWxlID0gJGNvcmVfdjJfdXBsb2FkZWRGaWxlLkdldCgkYXR0YWNoZWRGaWxlQ29udGV4dCwgJGF0dGFjaGVkRmlsZU5hbWUpKQ0KCSNpZiAoJGF0dGFjaGVkRmlsZSkNCgkgICAjc2V0ICgkYXR0YWNoZWRVcmwgPSAkYXR0YWNoZWRGaWxlLlVybCkNCgkjZW5kDQojZW5kDQoNCiNzZXQgKCRvcHRpb25zID0gIiV7IEdyb3VwSWQgPSAkZ3JvdXBJZCB9IikNCiNpZiAoJGF0dGFjaGVkVXJsKQ0KICAgICRvcHRpb25zLkFkZCgnQXR0YWNoZWRVcmwnLCAkYXR0YWNoZWRVcmwpDQojZW5kDQoNCiRjb3JlX3YyX3N0YXR1c01lc3NhZ2UuUHJldmlld0F0dGFjaG1lbnQoJG1lc3NhZ2VCb2R5LCAkb3B0aW9ucyk=</file>
			<file name="search-groups.vm">77u/IyMNCiMjIEN1c3RvbSBHcm91cCBTZWFyY2hpbmcgY2FsbGJhY2sgdG8gc3VwcG9ydCBhbHNvIHJldHJpZXZpbmcgcmVzaXplZCBBdmF0YXJIdG1sIG92ZXIgd2hhdCdzIHBvc3NpYmxlIGZyb20gUkVTVA0KIyMNCg0KJGNvcmVfdjJfcGFnZS5TZXRDb250ZW50VHlwZSgnYXBwbGljYXRpb24vanNvbicpDQoNCiNzZXQgKCRwYWdlU2l6ZSA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCJwYWdlU2l6ZSIpKSkNCiNzZXQgKCRwYWdlSW5kZXggPSAkY29yZV92Ml91dGlsaXR5LlBhcnNlSW50KCRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgicGFnZUluZGV4IikpKQ0KI3NldCAoJHF1ZXJ5ID0gJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCJxdWVyeSIpKQ0KDQojc2V0ICgkZ3JvdXBzID0gJGNvcmVfdjJfZ3JvdXAuTGlzdCgiJXsgUGFnZUluZGV4ID0gJHBhZ2VJbmRleCwgUGFnZVNpemUgPSAkcGFnZVNpemUsIEdyb3VwTmFtZUZpbHRlciA9ICRxdWVyeSwgVXNlcklkID0gJGNvcmVfdjJfdXNlci5BY2Nlc3NpbmcuSWQsIEluY2x1ZGVBbGxTdWJHcm91cHMgPSAndHJ1ZScgfSIpKQ0KI3NldCAoJGltYWdlT3B0aW9ucyA9ICIleyBSZXNpemVNZXRob2QgPSAnWm9vbUFuZENyb3AnIH0iKQ0KDQp7DQoJImdyb3VwcyI6IFsNCiNmb3JlYWNoICgkZ3JvdXAgaW4gJGdyb3VwcykNCgkJew0KCQkJIm5hbWUiOiAiJGNvcmVfdjJfZW5jb2RpbmcuSmF2YXNjcmlwdEVuY29kZSgkZ3JvdXAuTmFtZSkiLA0KCQkJImlkIjogIiRjb3JlX3YyX2VuY29kaW5nLkphdmFzY3JpcHRFbmNvZGUoJGdyb3VwLkNvbnRhaW5lcklkLlRvU3RyaW5nKCkpIiwNCgkJCSJhdmF0YXJIdG1sIjogIiRjb3JlX3YyX2VuY29kaW5nLkphdmFzY3JpcHRFbmNvZGUoJGNvcmVfdjJfdWkuR2V0UmVzaXplZEltYWdlSHRtbCgkZ3JvdXAuQXZhdGFyVXJsLCAxNiwgMTYsICRpbWFnZU9wdGlvbnMpKSIsDQoJCQkiZGF0ZSI6ICIkY29yZV92Ml9lbmNvZGluZy5KYXZhc2NyaXB0RW5jb2RlKCRjb3JlX3YyX2xhbmd1YWdlLkZvcm1hdERhdGUoJGdyb3VwLkNyZWF0ZWREYXRlLCAiJXsgRm9ybWF0ID0gJ3l5eXktTU0tZGRUSEg6bW06c3MnIH0iKSkiDQoJCX0NCiNiZXR3ZWVuDQosDQojZW5kDQoJXQ0KfQ0K</file>
			<file name="store-temp-data.vm">I2lmICgkY29yZV92Ml9wYWdlLklzUG9zdCkNCgkkY29yZV92Ml9wYWdlLlNldENvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi9qc29uJykNCg0KCSNzZXQoJGRhdGEgPSAkY29yZV92Ml9wYWdlLk1ha2VRdWVyeVN0cmluZygiJXt9IikpDQoNCgkjc2V0KCRib2R5ID0gZmFsc2UpDQoJI3NldCgkYm9keSA9ICRjb3JlX3YyX3BhZ2UuR2V0Rm9ybVZhbHVlKCdib2R5JykpDQoJI2lmKCRib2R5KQ0KCQkkZGF0YS5BZGQoJ2JvZHknLCAkYm9keSkNCgkjZW5kDQoNCgkjc2V0KCRmaWxlbmFtZSA9IGZhbHNlKQ0KCSNzZXQoJGZpbGVuYW1lID0gJGNvcmVfdjJfcGFnZS5HZXRGb3JtVmFsdWUoJ2ZpbGVuYW1lJykpDQoJI2lmKCRmaWxlbmFtZSkNCgkJJGRhdGEuQWRkKCdmaWxlbmFtZScsICRmaWxlbmFtZSkNCgkjZW5kDQoNCgkjc2V0KCRmaWxlY29udGV4dGlkID0gZmFsc2UpDQoJI3NldCgkZmlsZWNvbnRleHRpZCA9ICRjb3JlX3YyX3BhZ2UuR2V0Rm9ybVZhbHVlKCdmaWxlY29udGV4dGlkJykpDQoJI2lmKCRmaWxlY29udGV4dGlkKQ0KCQkkZGF0YS5BZGQoJ2ZpbGVjb250ZXh0aWQnLCAkZmlsZWNvbnRleHRpZCkNCgkjZW5kDQoNCgkjc2V0KCRmaWxldXJsID0gZmFsc2UpDQoJI3NldCgkZmlsZXVybCA9ICRjb3JlX3YyX3BhZ2UuR2V0Rm9ybVZhbHVlKCdmaWxldXJsJykpDQoJI2lmKCRmaWxldXJsKQ0KCQkkZGF0YS5BZGQoJ2ZpbGV1cmwnLCAkZmlsZXVybCkNCgkjZW5kDQoNCgkjc2V0KCRzdG9yZUlkID0gJGNvcmVfdjJfdXRpbGl0eS5TdG9yZVRlbXBvcmFyeURhdGEoJGRhdGEuVG9TdHJpbmcoKSkpDQoNCgl7InRlbXBvcmFyeURhdGEiOiIkY29yZV92Ml9lbmNvZGluZy5KYXZhc2NyaXB0RW5jb2RlKCRzdG9yZUlkKSJ9DQojZW5k</file>
			<file name="ui.js">KGZ1bmN0aW9uKCQsIGdsb2JhbCwgdW5kZWYpIHsNCg0KCXZhciBwYWdlU2l6ZSA9IDU7DQoNCgkvLyBEYXRhIE1vZGVscw0KDQoJLy8gY3VzdG9tIEpTT04gc3RvcmFnZSB3aGljaCBzdG9yZXMgYWxsIGl0ZW1zDQoJLy8gc2NvcGVkIHRvIHRoZSBjdXJyZW50IHVzZXIgYW5kIGluIGRpZmZlcmVudA0KCS8vIGJhY2tlbmRzIGRlcGVuZGluZyBvbiBhbm9ueW1vdXMgb3IgcmVnaXN0ZXJlZA0KCXZhciBjb250ZXh0U3RvcmFnZSA9IChmdW5jdGlvbigpew0KDQoJCXZhciBzdG9yZSA9ICQudGVsbGlnZW50LmV2b2x1dGlvbi51c2VyLmFjY2Vzc2luZy5pc1N5c3RlbUFjY291bnQNCgkJCT8gZ2xvYmFsLnNlc3Npb25TdG9yYWdlDQoJCQk6IGdsb2JhbC5sb2NhbFN0b3JhZ2U7DQoNCgkJZnVuY3Rpb24gYWRkVXNlclRvS2V5KGtleSkgew0KCQkJcmV0dXJuICQudGVsbGlnZW50LmV2b2x1dGlvbi51c2VyLmFjY2Vzc2luZy5pZCArICc6JyArIGtleTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGFkZE5hbWVTcGFjZVRvS2V5KGtleSkgew0KCQkJcmV0dXJuICdxaV8nICsgJzonICsga2V5Ow0KCQl9DQoNCgkJcmV0dXJuIHsNCgkJCWdldDogZnVuY3Rpb24oa2V5KSB7DQoJCQkJcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24oZCl7DQoJCQkJCWdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJCQlpZiAoIXN0b3JlKSB7IGQucmVqZWN0KCk7IH0NCgkJCQkJCWQucmVzb2x2ZShKU09OLnBhcnNlKHN0b3JlLmdldEl0ZW0oYWRkTmFtZVNwYWNlVG9LZXkoYWRkVXNlclRvS2V5KGtleSkpKSkpOw0KCQkJCQl9LCAxKTsNCgkJCQl9KS5wcm9taXNlKCk7DQoJCQl9LA0KCQkJc2V0OiBmdW5jdGlvbihrZXksIGRhdGEpIHsNCgkJCQlyZXR1cm4gJC5EZWZlcnJlZChmdW5jdGlvbihkKXsNCgkJCQkJZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJCWlmICghc3RvcmUpIHsgZC5yZWplY3QoKTsgfQ0KCQkJCQkJc3RvcmUuc2V0SXRlbShhZGROYW1lU3BhY2VUb0tleShhZGRVc2VyVG9LZXkoa2V5KSksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTsNCgkJCQkJCWQucmVzb2x2ZSgpOw0KCQkJCQl9LCAxKTsNCgkJCQl9KS5wcm9taXNlKCk7DQoJCQl9LA0KCQkJcmVtb3ZlOiBmdW5jdGlvbihrZXkpIHsNCgkJCQlyZXR1cm4gJC5EZWZlcnJlZChmdW5jdGlvbihkKXsNCgkJCQkJZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJCWlmICghc3RvcmUpIHsgZC5yZWplY3QoKTsgfQ0KCQkJCQkJc3RvcmUucmVtb3ZlSXRlbShhZGROYW1lU3BhY2VUb0tleShhZGRVc2VyVG9LZXkoa2V5KSkpOw0KCQkJCQkJZC5yZXNvbHZlKCk7DQoJCQkJCX0sIDEpOw0KCQkJCX0pLnByb21pc2UoKTsNCgkJCX0NCgkJfTsNCg0KCX0pKCk7DQoNCgkvLyBBcHAgY2xpZW50LXNpZGUgQXBpIEludGVyYWN0aW9uDQoJdmFyIGFwaU1vZGVsID0gew0KCQkvLyBvcHRpb25zDQoJCS8vICAgbWVzc2FnZQ0KCQkvLyAgIGNvbnRhaW5lcklkDQoJCS8vICAgdXBsb2FkQ29udGV4dElkDQoJCS8vICAgYXR0YWNoZWRGaWxlTmFtZQ0KCQljcmVhdGVTdGF0dXM6IGZ1bmN0aW9uKGNvbnRleHQsIG9wdGlvbnMpIHsNCgkJCXZhciBkYXRhID0gew0KCQkJCW1lc3NhZ2U6IG9wdGlvbnMubWVzc2FnZSwNCgkJCQljb250YWluZXJJZDogb3B0aW9ucy5jb250YWluZXJJZCwNCgkJCQljb250ZXh0SWQ6IG9wdGlvbnMudXBsb2FkQ29udGV4dElkDQoJCQl9Ow0KCQkJaWYob3B0aW9ucy5hdHRhY2hlZEZpbGVOYW1lKSB7DQoJCQkJZGF0YS5maWxlTmFtZSA9IG9wdGlvbnMuYXR0YWNoZWRGaWxlTmFtZQ0KCQkJfTsNCgkJCXJldHVybiAkLnRlbGxpZ2VudC5ldm9sdXRpb24ucG9zdCh7DQoJCQkJdXJsOiBjb250ZXh0LmFkZFVybCwNCgkJCQlkYXRhOiBkYXRhDQoJCQl9KTsNCgkJfSwNCgkJLy8gb3B0aW9ucw0KCQkvLyAgIG1lc3NhZ2VCb2R5DQoJCS8vICAgZ3JvdXBJZA0KCQkvLyAgIHVwbG9hZENvbnRleHRJZA0KCQkvLyAgIGF0dGFjaGVkRmlsZU5hbWUNCgkJZ2V0UHJldmlldzogZnVuY3Rpb24oY29udGV4dCwgb3B0aW9ucykgew0KCQkJdmFyIGRhdGEgPSB7DQoJCQkJd19tZXNzYWdlQm9keTogb3B0aW9ucy5tZXNzYWdlQm9keSwNCgkJCQl3X2dyb3VwSWQ6IG9wdGlvbnMuZ3JvdXBJZA0KCQkJfTsNCgkJCWlmKG9wdGlvbnMuYXR0YWNoZWRGaWxlTmFtZSAmJiBvcHRpb25zLnVwbG9hZENvbnRleHRJZCkgew0KCQkJCWRhdGFbJ3dfYXR0YWNoZWRGaWxlQ29udGV4dCddID0gb3B0aW9ucy51cGxvYWRDb250ZXh0SWQsDQoJCQkJZGF0YVsnd19hdHRhY2hlZEZpbGVOYW1lJ10gPSBvcHRpb25zLmF0dGFjaGVkRmlsZU5hbWUNCgkJCX07DQoJCQlyZXR1cm4gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnBvc3Qoew0KCQkJCXVybDogY29udGV4dC5wcmV2aWV3QXR0YWNobWVudFVybCwNCgkJCQlkYXRhOiBkYXRhDQoJCQl9KTsNCgkJfSwNCgkJLy8gb3B0aW9ucw0KCQkvLyAgIHBhZ2VJbmRleA0KCQlnZXRCb29rbWFya2VkQW5kVXNlckdyb3VwczogZnVuY3Rpb24oY29udGV4dCwgb3B0aW9ucykgew0KCQkJcmV0dXJuICQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoew0KCQkJCXVybDogY29udGV4dC5ncm91cEJvb2ttYXJrQW5kTWVtYmVyc2hpcFVybCwNCgkJCQlkYXRhOiB7DQoJCQkJCXBhZ2VJbmRleDogMCwNCgkJCQkJcGFnZVNpemU6IHBhZ2VTaXplDQoJCQkJfQ0KCQkJfSkudGhlbihmdW5jdGlvbihyKXsNCgkJCQlyLm1lbWJlcnNoaXBzID0gJC5tYXAoci5tZW1iZXJzaGlwcywgZnVuY3Rpb24oZykgew0KCQkJCQlnLmRhdGUgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24ucGFyc2VEYXRlKGcuZGF0ZSkuZ2V0VGltZSgpDQoJCQkJCXJldHVybiBnOw0KCQkJCX0pOw0KCQkJCXIuYm9va21hcmtzID0gJC5tYXAoci5ib29rbWFya3MsIGZ1bmN0aW9uKGcpIHsNCgkJCQkJZy5kYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnBhcnNlRGF0ZShnLmRhdGUpLmdldFRpbWUoKQ0KCQkJCQlyZXR1cm4gZzsNCgkJCQl9KTsNCgkJCQlyZXR1cm4gcjsNCgkJCX0pOw0KCQl9LA0KCQkvLyBvcHRpb25zDQoJCS8vICAgcXVlcnkNCgkJc2VhcmNoR3JvdXBzOiBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7DQoJCQlyZXR1cm4gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLmdldCh7DQoJCQkJdXJsOiBjb250ZXh0Lmdyb3VwU2VhcmNoVXJsLA0KCQkJCWRhdGE6IHsNCgkJCQkJcGFnZUluZGV4OiAwLA0KCQkJCQlwYWdlU2l6ZTogcGFnZVNpemUsDQoJCQkJCXF1ZXJ5OiBvcHRpb25zLnF1ZXJ5DQoJCQkJfQ0KCQkJfSkudGhlbihmdW5jdGlvbihyKXsNCgkJCQlyZXR1cm4gJC5tYXAoci5ncm91cHMsIGZ1bmN0aW9uKGcpIHsNCgkJCQkJZy5kYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnBhcnNlRGF0ZShnLmRhdGUpLmdldFRpbWUoKQ0KCQkJCQlyZXR1cm4gZzsNCgkJCQl9KTsNCgkJCX0pOw0KCQl9LA0KCQkvLyBvcHRpb25zDQoJCS8vICAgY29udGFpbmVySWQNCgkJbG9hZEdyb3VwRmllbGRzOiBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7DQoJCQlyZXR1cm4gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLmdldCh7DQoJCQkJdXJsOiBjb250ZXh0LmxvYWRGb3JtVXJsLA0KCQkJCWRhdGE6IHsNCgkJCQkJQ29udGFpbmVySWQ6IG9wdGlvbnMuY29udGFpbmVyaWQNCgkJCQl9DQoJCQl9KTsNCgkJfSwNCgkJLy8gb3B0aW9ucw0KCQkvLyAgIGJvZHkNCgkJLy8gICBmaWxlbmFtZQ0KCQkvLyAgIGZpbGVjb250ZXh0aWQNCgkJLy8gICBmaWxldXJsDQoJCXN0b3JlVGVtcG9yYXJ5RGF0YTogZnVuY3Rpb24oY29udGV4dCwgb3B0aW9ucykgew0KCQkJcmV0dXJuICQudGVsbGlnZW50LmV2b2x1dGlvbi5wb3N0KHsNCgkJCQl1cmw6IGNvbnRleHQuc3RvcmVVcmwsDQoJCQkJZGF0YTogew0KCQkJCQlib2R5OiBvcHRpb25zLmJvZHksDQoJCQkJCWZpbGVuYW1lOiBvcHRpb25zLmZpbGVuYW1lLA0KCQkJCQlmaWxlY29udGV4dGlkOiBvcHRpb25zLmZpbGVjb250ZXh0aWQsDQoJCQkJCWZpbGV1cmw6IG9wdGlvbnMuZmlsZXVybA0KCQkJCX0NCgkJCX0pOw0KCQl9DQoJfTsNCg0KCS8vIEVuY2Fwc3VsYXRlcyBMb2dpYyBhcm91bmQgZ3JvdXAgc3VnZ2VzdGlvbnMgYW5kIHNlbGVjdGlvbnMNCgl2YXIgZ3JvdXBNb2RlbCA9IChmdW5jdGlvbigpew0KDQoJCWZ1bmN0aW9uIGxvYWRTZWxlY3RlZEdyb3VwcygpIHsNCgkJCXJldHVybiBjb250ZXh0U3RvcmFnZS5nZXQoJ2cnKS50aGVuKGZ1bmN0aW9uKHIpew0KCQkJCWlmKHIgJiYgci5ncm91cHMpDQoJCQkJCXJldHVybiByLmdyb3VwczsNCgkJCQlyZXR1cm4gW107DQoJCQl9KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHN0b3JlU2VsZWN0ZWRHcm91cHMoZ3JvdXBzKSB7DQoJCQlyZXR1cm4gY29udGV4dFN0b3JhZ2Uuc2V0KCdnJywgeyBncm91cHM6IGdyb3VwcyB9KTsNCgkJfQ0KDQoJCS8vIGFkZHMgYSBncm91cCAoZ3JvdXApIHRvIGFuIGFycmF5IG9mIGdyb3VwcyAoc2VsZWN0aW9uKQ0KCQkvLyBwb3NpdGlvbmVkIGFjY29yZGluZyB0byBpdHMgJ2RhdGUnIGZpZWxkLCBhc2NlbmRpbmcsDQoJCS8vIGlmIG1hdGNoZXMgYW4gZXhpc3RpbmcgZ3JvdXAgaW4gdGhlIHNlbGVjdGlvbiAoYWNjb3JkaW5nIHRvIGlkKQ0KCQkvLyB0aGVuIGl0IHJlcGxhY2VzIHRoZSBleGlzdGluZyB3aXRoIG5ldywgYW5kIHBvc2l0aW9ucyBhY2NvcmRpbmcgdG8gbmV3IGRhdGUNCgkJLy8gaWYgbGltaXQgaXMgcmVhY2hlZCwgdHJ1bmNhdGVzIG9sZGVzdCBncm91cCBpbiBzZWxlY3Rpb24NCgkJZnVuY3Rpb24gbWVyZ2VHcm91cEludG9TZWxlY3Rpb24oc2VsZWN0aW9uLCBncm91cCwgbGltaXQpIHsNCgkJCXNlbGVjdGlvbiA9IHNlbGVjdGlvbiB8fCBbXTsNCgkJCWlmKCFncm91cCkNCgkJCQlyZXR1cm4gc2VsZWN0aW9uOw0KDQoJCQkvLyBmaXJzdCByZW1vdmUgbWF0Y2hpbmcgaXRlbXMgZnJvbSBzZWxlY3Rpb24NCgkJCXNlbGVjdGlvbiA9ICQuZ3JlcChzZWxlY3Rpb24sIGZ1bmN0aW9uKGcpIHsNCgkJCQlyZXR1cm4gZy5pZCAhPT0gZ3JvdXAuaWQ7DQoJCQl9KTsNCg0KCQkJLy8gdGhlbiBhZGQgaXQgdG8gdGhlIGxpc3QNCgkJCXNlbGVjdGlvbi5wdXNoKGdyb3VwKTsNCg0KCQkJLy8gdGhlbiBzb3J0IHRoZSBsaXN0IGJ5IGRhdGUNCgkJCXNlbGVjdGlvbiA9IHNlbGVjdGlvbi5zb3J0KGZ1bmN0aW9uKGEsIGIpew0KCQkJCXJldHVybiBiLmRhdGUgLSBhLmRhdGU7DQoJCQl9KTsNCg0KCQkJLy8gdGhlbiB0cnVuY2F0ZSBvdmVyIHRoZSBsaW1pdA0KCQkJc2VsZWN0aW9uID0gc2VsZWN0aW9uLnNsaWNlKDAsIGxpbWl0KQ0KDQoJCQlyZXR1cm4gc2VsZWN0aW9uOw0KCQl9DQoNCgkJZnVuY3Rpb24gbWVyZ2VHcm91cExpc3QoZXhpc3RpbmdJdGVtcywgbmV3SXRlbXMpIHsNCgkJCXZhciBtZXJnZWQgPSBleGlzdGluZ0l0ZW1zOw0KCQkJZm9yKHZhciBpID0gMDsgaSA8IG5ld0l0ZW1zLmxlbmd0aDsgaSsrKSB7DQoJCQkJbWVyZ2VkID0gbWVyZ2VHcm91cEludG9TZWxlY3Rpb24obWVyZ2VkLCBuZXdJdGVtc1tpXSwgcGFnZVNpemUpOw0KCQkJfQ0KCQkJcmV0dXJuIG1lcmdlZDsNCgkJfQ0KDQoJCXJldHVybiB7DQoJCQkvLyBSZXR1cm5zIGEgdW5pcXVlIGxpc3Qgb2YgZ3JvdXAgc2VsZWN0aW9ucyBpbmNsdWRpbmcsIGluIHByaW9yaXR5IG9yZGVyIG9mIHVzZToNCgkJCS8vIHByZXZpb3VzbHkgc2VsZWN0ZWQgZ3JvdXBzDQoJCQkvLyBib29rbWFya2VkIGdyb3Vwcw0KCQkJLy8gbWVtYmVyc2hpcCBncm91cHMNCgkJCWxpc3RTdWdnZXN0aW9uczogZnVuY3Rpb24oY29udGV4dCkgew0KCQkJCXZhciBncm91cExpc3QgPSBbXTsNCg0KCQkJCXJldHVybiAkLkRlZmVycmVkKGZ1bmN0aW9uKGQpew0KCQkJCQkvLyBsb2FkIHByZXZpb3VzbHkgc2VsZWN0ZWQgaXRlbXMNCgkJCQkJbG9hZFNlbGVjdGVkR3JvdXBzKCkuZG9uZShmdW5jdGlvbihwcmV2aW91c2x5U2VsZWN0ZWQpew0KCQkJCQkJLy8gaWYgdGhlcmUncyBsZXNzIHRoZW4gdGhlIHBhZ2Ugc2l6ZSBpbiBwcmV2aW91cyBzZWxlY3Rpb25zDQoJCQkJCQlpZihwcmV2aW91c2x5U2VsZWN0ZWQubGVuZ3RoIDwgcGFnZVNpemUpIHsNCgkJCQkJCQkvLyB0aGVuIGJ1aWxkIHVwIGEgbmV3IGxpc3QgYmFzZWQgb24gYm9va21hcmtzIGFuZCBtZW1iZXJzaGlwcw0KCQkJCQkJCWFwaU1vZGVsLmdldEJvb2ttYXJrZWRBbmRVc2VyR3JvdXBzKGNvbnRleHQpLmRvbmUoZnVuY3Rpb24oZyl7DQoJCQkJCQkJCS8vIGFuZCBhZGQgdGhlbSB0byB0aGUgbGlzdCBpbiBwcmlvcml0eSwgYXNjZW5kaW5nOg0KCQkJCQkJCQkvLyBsb3dlc3Qgb3JkZXJpbmcgcHJpb3JpdHkgaXMgbWVtYmVyc2hpcHMNCgkJCQkJCQkJZ3JvdXBMaXN0ID0gbWVyZ2VHcm91cExpc3QoZ3JvdXBMaXN0LCBnLm1lbWJlcnNoaXBzKTsNCgkJCQkJCQkJLy8gdGhlbiBib29rbWFya3MNCgkJCQkJCQkJZ3JvdXBMaXN0ID0gbWVyZ2VHcm91cExpc3QoZ3JvdXBMaXN0LCBnLmJvb2ttYXJrcyk7DQoJCQkJCQkJCS8vIHRoZW4gcHJldmlvdXMgc2VsZWN0aW9ucw0KCQkJCQkJCQlncm91cExpc3QgPSBtZXJnZUdyb3VwTGlzdChncm91cExpc3QsIHByZXZpb3VzbHlTZWxlY3RlZCB8fCBbXSk7DQoJCQkJCQkJCS8vIHJldHVybiBsaXN0DQoJCQkJCQkJCWQucmVzb2x2ZShncm91cExpc3QpOw0KCQkJCQkJCX0pOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBvdGhlcndpc2UsIGp1c3Qgc2V0IHRoZSBncm91cCBsaXN0IHRvIHByZXZpb3VzbHkgc2VsZWN0ZWQNCgkJCQkJCQkvLyBhbmQgdHJ1bmNhdGUgaWYgbmVjZXNzYXJ5DQoJCQkJCQkJZ3JvdXBMaXN0ID0gKHByZXZpb3VzbHlTZWxlY3RlZCB8fCBbXSkuc2xpY2UoMCwgcGFnZVNpemUpOw0KCQkJCQkJCS8vIHJldHVybiBsaXN0DQoJCQkJCQkJZC5yZXNvbHZlKGdyb3VwTGlzdCk7DQoJCQkJCQl9DQoJCQkJCX0pOw0KCQkJCX0pLnByb21pc2UoKTsNCgkJCX0sDQoJCQkvLyBpZGVudGlmaWVzIGEgZ3JvdXAgYXMgcHJldmlvdXNseSBzZWxlY3RlZA0KCQkJc2VsZWN0OiBmdW5jdGlvbihncm91cCkgew0KCQkJCXJldHVybiAkLkRlZmVycmVkKGZ1bmN0aW9uKGQpew0KCQkJCQkvLyBsb2FkIHByZXZpb3VzbHkgc2VsZWN0ZWQgZ3JvdXBzDQoJCQkJCWxvYWRTZWxlY3RlZEdyb3VwcygpLmRvbmUoZnVuY3Rpb24ocHJldmlvdXNseVNlbGVjdGVkKXsNCgkJCQkJCS8vIHVzaW5nIGN1cnJlbnQgdGltZSBhcyBzZWxlY3RlZCBncm91cCdzIHNvcnQgZGF0ZQ0KCQkJCQkJLy8gKHNlbGVjdGVkIGdyb3VwcycgZGF0ZXMgYXJlIHRoZWlyIHNlbGVjdGlvbiB0aW1lcykNCgkJCQkJCWdyb3VwLmRhdGUgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkpOw0KCQkJCQkJLy8gbWVyZ2Ugc2VsZWN0ZWQgZ3JvdXAgaW50byBwcmV2aW91cyBzZWxlY3Rpb25zDQoJCQkJCQlwcmV2aW91c2x5U2VsZWN0ZWQgPSBtZXJnZUdyb3VwSW50b1NlbGVjdGlvbihwcmV2aW91c2x5U2VsZWN0ZWQgfHwgW10sIGdyb3VwLCBwYWdlU2l6ZSk7DQoJCQkJCQkvLyBwZXJzaXN0IHNlbGVjdGlvbnMNCgkJCQkJCXN0b3JlU2VsZWN0ZWRHcm91cHMocHJldmlvdXNseVNlbGVjdGVkKS5kb25lKGQucmVzb2x2ZSk7DQoJCQkJCX0pOw0KCQkJCX0pLnByb21pc2UoKTsNCgkJCX0NCgkJfTsNCgl9KSgpOw0KDQoNCgkvLyBHcm91cCBTZWxlY3RvciBVSToNCgl2YXIgR3JvdXBTZWxlY3RvciA9IChmdW5jdGlvbigpew0KCQl2YXIgZGVmYXVsdHMgPSB7DQoJCQl3cmFwcGVyOiAnJywNCgkJCXNlbGVjdG9yVGVtcGxhdGU6ICcnLA0KCQkJcmVzdWx0c1RlbXBsYXRlOiAnJywNCgkJCWluaXRpYWxOYW1lOiBudWxsLA0KCQkJaW5pdGlhbENvbnRhaW5lcklkOiBudWxsLA0KCQkJaW5pdGlhbEF2YXRhckh0bWw6IG51bGwsDQoJCQlvblByZUZpbGw6IGZ1bmN0aW9uKCkge30sDQoJCQlvblNlYXJjaDogZnVuY3Rpb24ocXVlcnkpIHt9LA0KCQkJb25TZWxlY3Q6IGZ1bmN0aW9uKGdyb3VwKSB7fQ0KCQl9Ow0KDQoJCWZ1bmN0aW9uIGluaXQoY29udGV4dCkgew0KCQkJaWYoY29udGV4dC5pbml0ZWQpIHsgcmV0dXJuOyB9DQoJCQljb250ZXh0LmluaXRlZCA9IHRydWU7DQoNCgkJCWJ1aWxkVWkoY29udGV4dCk7DQoJCQloYW5kbGVFdmVudHMoY29udGV4dCk7DQoJCX0NCg0KCQlmdW5jdGlvbiBidWlsZFVpKGNvbnRleHQpIHsNCgkJCS8vIGJ1aWxkIHRlbXBsYXRlcw0KCQkJY29udGV4dC5zZWxlY3RvclRlbXBsYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5zZWxlY3RvclRlbXBsYXRlKTsNCgkJCWNvbnRleHQucmVzdWx0c1RlbXBsYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5yZXN1bHRzVGVtcGxhdGUpOw0KDQoJCQkvLyBjcmVhdGUgZWxlbWVudHMNCgkJCWNvbnRleHQuZ3JvdXBMaW5rID0gJChjb250ZXh0LndyYXBwZXIpLmZpbmQoJ2EuaW50ZXJuYWwtbGluaycpOw0KCQkJY29udGV4dC5ncm91cEF2YXRhciA9ICQoY29udGV4dC53cmFwcGVyKS5maW5kKCcuZ3JvdXAtYXZhdGFyJyk7DQoJCQljb250ZXh0LmNhbmNlbFNlbGVjdGlvbldyYXBwZXIgPSAkKGNvbnRleHQud3JhcHBlcikuZmluZCgnLmNhbmNlbC1zZWxlY3Rpb24nKTsNCgkJCWNvbnRleHQuY2FuY2VsU2VsZWN0aW9uTGluayA9IGNvbnRleHQuY2FuY2VsU2VsZWN0aW9uV3JhcHBlci5maW5kKCdhJyk7DQoNCgkJCWNvbnRleHQucG9wdXAgPSAkKCc8ZGl2PjwvZGl2PicpLmdsb3dQb3BVcFBhbmVsKHsNCgkJCQljc3NDbGFzczogJ2dyb3VwLXNlbGVjdG9yLXdyYXBwZXInLA0KCQkJCWhpZGVPbkRvY3VtZW50Q2xpY2s6IGZhbHNlLA0KCQkJCXBvc2l0aW9uOiAndXBkb3duJywNCgkJCQl6SW5kZXg6IDEwMDANCgkJCX0pLm9uKCdnbG93UG9wVXBQYW5lbFNob3dpbmcnLCBmdW5jdGlvbihlLCBkYXRhKSB7DQoJCQkJY29udGV4dC53cmFwcGVyLmFkZENsYXNzKCdsaW5rcy1leHBhbmRlZCcpLmF0dHIoJ2RhdGEtcG9zaXRpb24nLCBkYXRhLnBvc2l0aW9uKTsNCgkJCX0pLm9uKCdnbG93UG9wVXBQYW5lbEhpZGluZycsIGZ1bmN0aW9uKGUsIGRhdGEpew0KCQkJCWNvbnRleHQud3JhcHBlci5yZW1vdmVDbGFzcygnbGlua3MtZXhwYW5kZWQnKS5hdHRyKCdkYXRhLXBvc2l0aW9uJywgJycpOw0KCQkJfSk7DQoNCgkJCWNvbnRleHQuZ3JvdXBzU2VsZWN0b3JFbGVtZW50ID0gJChjb250ZXh0LnNlbGVjdG9yVGVtcGxhdGUoew0KDQoJCQl9KSk7DQoNCgkJCS8vIGNvbGxlY3QgZWxlbWVudCByZWZlcmVuY2VzDQoJCQljb250ZXh0Lmdyb3Vwc0VsZW1lbnQgPSBjb250ZXh0Lmdyb3Vwc1NlbGVjdG9yRWxlbWVudC5maW5kKCcuZ3JvdXBzJyk7DQoJCQljb250ZXh0Lmdyb3VwU2VhcmNoSW5wdXQgPSBjb250ZXh0Lmdyb3Vwc1NlbGVjdG9yRWxlbWVudC5maW5kKCdpbnB1dC5zZWFyY2gnKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGhhbmRsZVNlbGVjdGlvbkFuZFJhaXNlRXZlbnQoY29udGV4dCwgbmFtZSwgY29udGFpbmVySWQsIGF2YXRhckh0bWwpIHsNCgkJCXZhciBncm91cCA9IHsNCgkJCQluYW1lOiBuYW1lLA0KCQkJCWlkOiBjb250YWluZXJJZCwNCgkJCQlhdmF0YXJIdG1sOiBhdmF0YXJIdG1sDQoJCQl9Ow0KCQkJY29udGV4dC5ncm91cEF2YXRhci5odG1sKGdyb3VwLmF2YXRhckh0bWwpOw0KCQkJY29udGV4dC5ncm91cExpbmsuaHRtbChncm91cC5uYW1lKTsNCgkJCWNvbnRleHQuY2FuY2VsU2VsZWN0aW9uV3JhcHBlci5zaG93KCk7DQoJCQljb250ZXh0Lm9uU2VsZWN0KGdyb3VwKTsNCg0KCQl9DQoNCgkJZnVuY3Rpb24gaGFuZGxlRXZlbnRzKGNvbnRleHQpIHsNCgkJCS8vIGNsaWNrcyBvdXRzaWRlIG9mIHBvcHVwIGNsb3NlIHRoZSBwb3B1cA0KCQkJJChkb2N1bWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsNCgkJCQljbG9zZShjb250ZXh0KTsNCgkJCX0pOw0KCQkJY29udGV4dC5ncm91cHNTZWxlY3RvckVsZW1lbnQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7DQoJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsNCgkJCX0pOw0KCQkJY29udGV4dC5jYW5jZWxTZWxlY3Rpb25MaW5rLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQljb250ZXh0Lmdyb3VwQXZhdGFyLmh0bWwoJycpOw0KCQkJCWNvbnRleHQuZ3JvdXBMaW5rLmh0bWwoY29udGV4dC5jYW5jZWxTZWxlY3Rpb25MaW5rLmF0dHIoJ2RhdGEtdGlwJykpOw0KCQkJCWNvbnRleHQuY2FuY2VsU2VsZWN0aW9uV3JhcHBlci5oaWRlKCk7DQoJCQkJY29udGV4dC5vbkNhbmNlbCgpOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0pOw0KDQoJCQkvLyBjbGlja3Mgb2YgZ3JvdXBzIHNlbGVjdCBncm91cHMgYW5kIGNsb3NlDQoJCQljb250ZXh0Lmdyb3Vwc1NlbGVjdG9yRWxlbWVudC5vbignY2xpY2snLCAnbGkgYScsIGZ1bmN0aW9uKGUpew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl2YXIgbGluayA9ICQoZS50YXJnZXQpOw0KDQoJCQkJaGFuZGxlU2VsZWN0aW9uQW5kUmFpc2VFdmVudChjb250ZXh0LA0KCQkJCQlsaW5rLmRhdGEoJ25hbWUnKSwNCgkJCQkJbGluay5kYXRhKCdjb250YWluZXJpZCcpLA0KCQkJCQlsaW5rLmNsb3Nlc3QoJ2xpLm5hdmlnYXRpb24tbGlzdC1pdGVtJykuZmluZCgnLmdyb3VwLWF2YXRhcicpLmh0bWwoKSk7DQoNCgkJCQljbG9zZShjb250ZXh0KTsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9KTsNCgkJCWNvbnRleHQuZ3JvdXBzU2VsZWN0b3JFbGVtZW50Lm9uKCdjbGljaycsJ2xpJywgZnVuY3Rpb24oZSl7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCSQodGhpcykuZmluZCgnLmludGVybmFsLWxpbmsnKS5jbGljaygpOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0pOw0KDQoJCQkvLyBzZWFyY2gNCgkJCWNvbnRleHQuc2VhcmNoVGltZW91dDsNCgkJCWNvbnRleHQuZ3JvdXBTZWFyY2hJbnB1dC5vbigna2V5dXAnLCBmdW5jdGlvbihlKXsNCgkJCQlnbG9iYWwuY2xlYXJUaW1lb3V0KGNvbnRleHQuc2VhcmNoVGltZW91dCk7DQoJCQkJY29udGV4dC5zZWFyY2hUaW1lb3V0ID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJdmFyIGN1cnJlbnRRdWVyeSA9ICQoZS50YXJnZXQpLnZhbCgpOw0KCQkJCQljb250ZXh0LmN1cnJlbnRRdWVyeSA9IGN1cnJlbnRRdWVyeTsNCgkJCQkJY29udGV4dC5vblNlYXJjaChjdXJyZW50UXVlcnkpLmRvbmUoZnVuY3Rpb24oZ3JvdXBzKXsNCgkJCQkJCWlmKGN1cnJlbnRRdWVyeSAhPSBjb250ZXh0LmN1cnJlbnRRdWVyeSkNCgkJCQkJCQlyZXR1cm47DQoJCQkJCQljb250ZXh0Lmdyb3Vwc0VsZW1lbnQuaHRtbChjb250ZXh0LnJlc3VsdHNUZW1wbGF0ZSh7DQoJCQkJCQkJZ3JvdXBzOiBncm91cHMNCgkJCQkJCX0pKTsNCgkJCQkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ3JlZnJlc2gnKTsNCgkJCQkJCWNvbnRleHQuZ3JvdXBTZWFyY2hJbnB1dC5mb2N1cygpOw0KCQkJCQl9KQ0KCQkJCX0sIDEwMCk7DQoJCQl9KS5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGUpew0KCQkJCWlmKGUud2hpY2ggPT09IDM4KSB7DQoJCQkJCXZhciBjdXJyZW50U2VsZWN0ZWQgPSBjb250ZXh0Lmdyb3Vwc0VsZW1lbnQuZmluZCgnbGkuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJdmFyIHByZXYgPSBjdXJyZW50U2VsZWN0ZWQubGVuZ3RoID4gMCA/IGN1cnJlbnRTZWxlY3RlZC5wcmV2KCdsaScpIDogbnVsbDsNCgkJCQkJaWYoY3VycmVudFNlbGVjdGVkLmxlbmd0aCA+IDAgJiYgcHJldi5sZW5ndGggPiAwKSB7DQoJCQkJCQlwcmV2LmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJY29udGV4dC5ncm91cHNFbGVtZW50LmZpbmQoJ2xpOmxhc3QtY2hpbGQnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJfQ0KCQkJCX0gZWxzZSBpZihlLndoaWNoID09PSA0MCkgew0KCQkJCQl2YXIgY3VycmVudFNlbGVjdGVkID0gY29udGV4dC5ncm91cHNFbGVtZW50LmZpbmQoJ2xpLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7DQoJCQkJCXZhciBuZXh0ID0gY3VycmVudFNlbGVjdGVkLmxlbmd0aCA+IDAgPyBjdXJyZW50U2VsZWN0ZWQubmV4dCgnbGknKSA6IG51bGw7DQoJCQkJCWlmKGN1cnJlbnRTZWxlY3RlZC5sZW5ndGggPiAwICYmIG5leHQubGVuZ3RoID4gMCkgew0KCQkJCQkJbmV4dC5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWNvbnRleHQuZ3JvdXBzRWxlbWVudC5maW5kKCdsaTpmaXJzdC1jaGlsZCcpLmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KCQkJCQl9DQoJCQkJfSBlbHNlIGlmKGUud2hpY2ggPT09IDEzKSB7DQoJCQkJCWNvbnRleHQuZ3JvdXBzRWxlbWVudC5maW5kKCdsaS5zZWxlY3RlZCcpLmZpbmQoJ2EuaW50ZXJuYWwtbGluaycpLmNsaWNrKCk7DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCg0KCQlmdW5jdGlvbiBvcGVuKGNvbnRleHQpIHsNCgkJCWNvbnRleHQub25QcmVGaWxsKCkuZG9uZShmdW5jdGlvbihncm91cHMpew0KDQoJCQkJY29udGV4dC5ncm91cHNFbGVtZW50Lmh0bWwoY29udGV4dC5yZXN1bHRzVGVtcGxhdGUoew0KCQkJCQlncm91cHM6IGdyb3Vwcw0KCQkJCX0pKTsNCg0KCQkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2h0bWwnLCBjb250ZXh0Lmdyb3Vwc1NlbGVjdG9yRWxlbWVudCkNCgkJCQkJCS5nbG93UG9wVXBQYW5lbCgnc2hvdycsIGNvbnRleHQud3JhcHBlcik7DQoNCgkJCQljb250ZXh0Lmdyb3VwU2VhcmNoSW5wdXQudmFsKCcnKS5mb2N1cygpOw0KCQkJfSk7DQoJCX0NCg0KCQlmdW5jdGlvbiBjbG9zZShjb250ZXh0KSB7DQoJCQljb250ZXh0Lmdyb3Vwc1NlbGVjdG9yRWxlbWVudC5kZXRhY2goKTsNCgkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2hpZGUnKTsNCgkJfQ0KDQoJCXJldHVybiBmdW5jdGlvbihvcHRpb25zKSB7DQoJCQl2YXIgY29udGV4dCA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgb3B0aW9ucyB8fCB7fSk7DQoNCgkJCSQoY29udGV4dC53cmFwcGVyKS5maW5kKCdhLmludGVybmFsLWxpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXsNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoNCgkJCQlpbml0KGNvbnRleHQpOw0KDQoJCQkJaWYoY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnaXNTaG93bicpKQ0KCQkJCQljbG9zZShjb250ZXh0KTsNCgkJCQllbHNlDQoJCQkJCW9wZW4oY29udGV4dCk7DQoNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9KTsNCg0KCQkJaWYoY29udGV4dC5pbml0aWFsQ29udGFpbmVySWQgJiYgY29udGV4dC5pbml0aWFsTmFtZSAmJiBjb250ZXh0LmluaXRpYWxBdmF0YXJIdG1sKSB7DQoJCQkJaW5pdChjb250ZXh0KTsNCgkJCQloYW5kbGVTZWxlY3Rpb25BbmRSYWlzZUV2ZW50KGNvbnRleHQsDQoJCQkJCWNvbnRleHQuaW5pdGlhbE5hbWUsDQoJCQkJCWNvbnRleHQuaW5pdGlhbENvbnRhaW5lcklkLA0KCQkJCQljb250ZXh0LmluaXRpYWxBdmF0YXJIdG1sKTsNCgkJCX0NCg0KCQkJcmV0dXJuIHsNCgkJCQljbG9zZTogZnVuY3Rpb24oKSB7DQoJCQkJCWNsb3NlKGNvbnRleHQpOw0KCQkJCX0NCgkJCX07DQoJCX0NCgl9KSgpOw0KDQoNCglmdW5jdGlvbiB2YWxpZGF0ZShjb250ZXh0KSB7DQoJCXRyeSB7DQoNCgkJCXZhciBjID0gY29udGV4dC5lZGl0b3IuZ2V0Q29udGVudCgpOw0KCQkJaWYgKCgoIWMgfHwgYy5sZW5ndGggPD0gMCB8fCAoL14oPHA+XHMqPzxcL3A+fFxzKnw8ZGl2PlxzKj88XC9kaXY+KSokL2kpLnRlc3QoYykpICYmICFjb250ZXh0LmF0dGFjaGVkRmlsZU5hbWUpIHx8IGNvbnRleHQudXBsb2FkaW5nID09PSB0cnVlKSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KDQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfSBjYXRjaCAoZSkgew0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gYWRkKGNvbnRleHQsIHZhbHVlLCBhdHRhY2hlZEZpbGVOYW1lKSB7DQoJCWlmICghdmFsaWRhdGUoY29udGV4dCkpDQoJCQlyZXR1cm47DQoNCgkJaWYoY29udGV4dC5hZGRpbmcpDQoJCQlyZXR1cm47DQoJCWNvbnRleHQuYWRkaW5nID0gdHJ1ZTsNCg0KCQlhcGlNb2RlbC5jcmVhdGVTdGF0dXMoY29udGV4dCwgew0KCQkJbWVzc2FnZTogY29udGV4dC5lZGl0b3IuZ2V0Q29udGVudCgpLA0KCQkJY29udGFpbmVySWQ6IGNvbnRleHQuY29udGFpbmVySWQsDQoJCQl1cGxvYWRDb250ZXh0SWQ6IGNvbnRleHQudXBsb2FkQ29udGV4dElkLA0KCQkJYXR0YWNoZWRGaWxlTmFtZTogY29udGV4dC5hdHRhY2hlZEZpbGVOYW1lDQoJCX0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2Upew0KCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm5vdGlmaWNhdGlvbnMuc2hvdyhjb250ZXh0LnN1Y2Nlc3NNZXNzYWdlLCB7IHR5cGU6ICdzdWNjZXNzJyB9KTsNCgkJCSQoZG9jdW1lbnQpLnRyaWdnZXIoJ3RlbGxpZ2VudF9tZXNzYWdpbmdfYWN0aXZpdHltZXNzYWdldXBkYXRlZCcsIFtyZXNwb25zZS5ib2R5XSk7DQoJCQkkKGRvY3VtZW50KS50cmlnZ2VyKCd0ZWxsaWdlbnRfY29yZV91c2Vyc3N0YXR1c3VwZGF0ZWQnLCBbcmVzcG9uc2UuYm9keV0pOw0KCQkJY29udGV4dC5lZGl0b3Iuc2V0Q29udGVudCgnJyk7DQoJCQlyZW1vdmVGaWxlKGNvbnRleHQpOw0KCQkJY2xlYXJQcmV2aWV3KGNvbnRleHQpOw0KCQkJdmFsaWRhdGUoY29udGV4dCk7DQoJCQljb250ZXh0LmFkZGluZyA9IGZhbHNlOw0KCQl9KQ0KCQkuZmFpbChmdW5jdGlvbih4aHIsIGRlc2MsIGV4KXsNCgkJCXZhbGlkYXRlKGNvbnRleHQpOw0KCQkJY29udGV4dC5hZGRpbmcgPSBmYWxzZTsNCgkJfSk7DQoJfQ0KDQoJZnVuY3Rpb24gcmVtb3ZlRmlsZShjb250ZXh0KSB7DQoJCWlmKGNvbnRleHQuZmlsZVJlbW92ZSkgew0KCQkJY29udGV4dC5maWxlUmVtb3ZlLmhpZGUoKTsNCgkJCWxvYWRQcmV2aWV3KGNvbnRleHQpOw0KCQkJY29udGV4dC5maWxlVXBsb2FkLmh0bWwoY29udGV4dC51cGxvYWRGaWxlTWVzc2FnZSkuYWRkQ2xhc3MoJ3VwbG9hZCcpLnJlbW92ZUNsYXNzKCdjaGFuZ2UnKTsNCgkJfQ0KCQljb250ZXh0LmF0dGFjaGVkRmlsZU5hbWUgPSBudWxsOw0KCQljb250ZXh0LnVwbG9hZGluZyA9IGZhbHNlOw0KCX0NCg0KCWZ1bmN0aW9uIHJlbG9hZFBhZ2UoKSB7DQoJCXdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjsNCgl9DQoNCglmdW5jdGlvbiBsb2FkUHJldmlldyhjb250ZXh0LCBmaWxlTmFtZSkgew0KCQlpZihmaWxlTmFtZSkgIHsNCgkJCWNvbnRleHQuYXR0YWNoZWRGaWxlTmFtZSA9IGZpbGVOYW1lOw0KCQl9DQoJCWNsZWFyVGltZW91dChjb250ZXh0LnByZXZpZXdUaW1lb3V0KTsNCgkJY29udGV4dC5wcmV2aWV3VGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCg0KCQkJYXBpTW9kZWwuZ2V0UHJldmlldyhjb250ZXh0LCB7DQoJCQkJbWVzc2FnZUJvZHk6IGNvbnRleHQuZWRpdG9yLmdldENvbnRlbnQoKSwNCgkJCQlncm91cElkOiBjb250ZXh0Lmdyb3VwSWQsDQoJCQkJdXBsb2FkQ29udGV4dElkOiBjb250ZXh0LnVwbG9hZENvbnRleHRJZCwNCgkJCQlhdHRhY2hlZEZpbGVOYW1lOiBjb250ZXh0LmF0dGFjaGVkRmlsZU5hbWUNCgkJCX0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2Upew0KCQkJCXJlc3BvbnNlID0gJC50cmltKHJlc3BvbnNlKTsNCgkJCQlpZihyZXNwb25zZSAmJiByZXNwb25zZS5sZW5ndGggPiAwKSB7DQoJCQkJCWlmIChyZXNwb25zZSAhPT0gY29udGV4dC5wcmV2aWV3Q29udGVudCkgew0KCQkJCQkJY29udGV4dC5wcmV2aWV3Q29udGVudCA9IHJlc3BvbnNlOw0KCQkJCQkJY29udGV4dC5wcmV2aWV3Q29udGFpbmVyLmh0bWwoY29udGV4dC5wcmV2aWV3Q29udGVudCk7DQoJCQkJCQljb250ZXh0LnByZXZpZXdDb250YWluZXIuY3NzKHsgZGlzcGxheTogJ2Jsb2NrJyB9KS5zbGlkZURvd24oMTAwKTsNCgkJCQkJfQ0KCQkJCX0gZWxzZSB7DQoJCQkJCWNvbnRleHQucHJldmlld0NvbnRlbnQgPSAnJzsNCgkJCQkJY29udGV4dC5wcmV2aWV3Q29udGFpbmVyLmh0bWwoJycpOw0KCQkJCQljb250ZXh0LnByZXZpZXdDb250YWluZXIuc2xpZGVVcCgxMDAsIGZ1bmN0aW9uKCl7DQoJCQkJCQljb250ZXh0LnByZXZpZXdDb250YWluZXIuY3NzKHsgZGlzcGxheTogJ25vbmUnIH0pOw0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9KTsNCg0KCQl9LCAxNTApOw0KCX0NCg0KCWZ1bmN0aW9uIGNsZWFyUHJldmlldyhjb250ZXh0KSB7DQoJCWNvbnRleHQucHJldmlld0NvbnRhaW5lci5zbGlkZVVwKDEwMCwgZnVuY3Rpb24oKXsNCgkJCWNvbnRleHQucHJldmlld0NvbnRhaW5lci5jc3MoeyBkaXNwbGF5OiAnbm9uZScgfSk7DQoJCX0pOw0KCQljbGVhclRpbWVvdXQoY29udGV4dC5wcmV2aWV3VGltZW91dCk7DQoJCWNvbnRleHQuYXR0YWNoZWRGaWxlTmFtZSA9IG51bGw7DQoJCWNvbnRleHQucHJldmlld0NvbnRlbnQgPSBudWxsOw0KCQljb250ZXh0LnByZXZpZXdDb250YWluZXIuZW1wdHkoKTsNCgl9DQoNCglmdW5jdGlvbiBpbml0aWFsaXplRmlsZVVwbG9hZChjb250ZXh0LCBkZXN0cm95KSB7DQoJCWlmIChjb250ZXh0LmZpbGVVcGxvYWRJbml0aWFsaXplZCkgew0KCQkJdHJ5IHsNCgkJCQljb250ZXh0LmZpbGVVcGxvYWQub2ZmKCcuYXR0YWNobWVudCcpLmdsb3dVcGxvYWQoJ2Rlc3Ryb3knKTsNCgkJCX0gY2F0Y2ggKGUpIHt9DQoJCQljb250ZXh0LmZpbGVVcGxvYWRJbml0aWFsaXplZCA9IGZhbHNlOw0KCQl9DQoNCgkJY29udGV4dC5maWxlVXBsb2FkDQoJCQkuZ2xvd1VwbG9hZCh7DQoJCQkJdXBsb2FkVXJsOiBjb250ZXh0LnVwbG9hZEZpbGVVcmwsDQoJCQkJcmVuZGVyTW9kZTogJ2xpbmsnDQoJCQl9KQ0KCQkJLm9uKCdnbG93VXBsb2FkQmVndW4uYXR0YWNobWVudCcsIGZ1bmN0aW9uKGUpIHsNCgkJCQljb250ZXh0LnVwbG9hZGluZyA9IHRydWU7DQoJCQkJdmFsaWRhdGUoY29udGV4dCk7DQoJCQkJY29udGV4dC5maWxlVXBsb2FkLmh0bWwoY29udGV4dC5wcm9ncmVzc01lc3NhZ2UucmVwbGFjZSgnezB9JywgMCkpOw0KCQkJfSkNCgkJCS5vbignZ2xvd1VwbG9hZENvbXBsZXRlLmF0dGFjaG1lbnQnLCBmdW5jdGlvbihlLCBmaWxlKSB7DQoJCQkJbG9hZFByZXZpZXcoY29udGV4dCwgZmlsZS5uYW1lKTsNCgkJCQljb250ZXh0LnVwbG9hZGluZyA9IGZhbHNlOw0KCQkJCWNvbnRleHQuZmlsZVVwbG9hZC5odG1sKGNvbnRleHQuY2hhbmdlRmlsZU1lc3NhZ2UpLnJlbW92ZUNsYXNzKCd1cGxvYWQnKS5hZGRDbGFzcygnY2hhbmdlJyk7DQoJCQkJY29udGV4dC5maWxlUmVtb3ZlLnNob3coKTsNCgkJCQl2YWxpZGF0ZShjb250ZXh0KTsNCgkJCX0pDQoJCQkub24oJ2dsb3dVcGxvYWRGaWxlUHJvZ3Jlc3MuYXR0YWNobWVudCcsIGZ1bmN0aW9uKGUsIGRldGFpbHMpIHsNCgkJCQljb250ZXh0LmZpbGVVcGxvYWQuaHRtbChjb250ZXh0LnByb2dyZXNzTWVzc2FnZS5yZXBsYWNlKCd7MH0nLCBkZXRhaWxzLnBlcmNlbnQpKTsNCgkJCX0pDQoJCQkub24oJ2dsb3dVcGxvYWRFcnJvcicsIGZ1bmN0aW9uKGUpIHsNCgkJCQljb250ZXh0LnVwbG9hZGluZyA9IGZhbHNlOw0KCQkJCWNvbnRleHQuZmlsZVVwbG9hZC5odG1sKGNvbnRleHQuY2hhbmdlRmlsZU1lc3NhZ2UpLnJlbW92ZUNsYXNzKCdjaGFuZ2UnKS5hZGRDbGFzcygndXBsb2FkJyk7DQoJCQl9KTsNCg0KCQljb250ZXh0LmZpbGVVcGxvYWRJbml0aWFsaXplZCA9IHRydWU7DQoJfQ0KDQoJZnVuY3Rpb24gaW5pdGlhbGl6ZUdyb3VwU2VsZWN0b3IoY29udGV4dCkgew0KCQljb250ZXh0Lmdyb3VwU2VsZWN0b3IgPSBuZXcgR3JvdXBTZWxlY3Rvcih7DQoJCQlzZWxlY3RvclRlbXBsYXRlOiBjb250ZXh0Lmdyb3VwU2VsZWN0b3JUZW1wbGF0ZUlkLA0KCQkJcmVzdWx0c1RlbXBsYXRlOiBjb250ZXh0Lmdyb3VwU2VsZWN0b3JHcm91cHNUZW1wbGF0ZUlkLA0KCQkJaW5pdGlhbE5hbWU6IGNvbnRleHQuaW5pdGlhbE5hbWUsDQoJCQlpbml0aWFsQ29udGFpbmVySWQ6IGNvbnRleHQuaW5pdGlhbENvbnRhaW5lcklkLA0KCQkJaW5pdGlhbEF2YXRhckh0bWw6IGNvbnRleHQuaW5pdGlhbEF2YXRhckh0bWwsDQoJCQlvblByZUZpbGw6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiBncm91cE1vZGVsLmxpc3RTdWdnZXN0aW9ucyhjb250ZXh0KTsNCgkJCX0sDQoJCQlvblNlYXJjaDogZnVuY3Rpb24ocXVlcnkpIHsNCgkJCQlyZXR1cm4gYXBpTW9kZWwuc2VhcmNoR3JvdXBzKGNvbnRleHQsIHsNCgkJCQkJcXVlcnk6IHF1ZXJ5DQoJCQkJfSk7DQoJCQl9LA0KCQkJb25TZWxlY3Q6IGZ1bmN0aW9uKGdyb3VwKSB7DQoJCQkJZ3JvdXBNb2RlbC5zZWxlY3QoZ3JvdXApOw0KCQkJCSQoY29udGV4dC5ncm91cFNlbGVjdG9ySWQpLmFkZENsYXNzKCd3aXRoLWF2YXRhcicpOw0KCQkJCWxvYWRGb3JtRmllbGRzKGNvbnRleHQsIGdyb3VwLmlkKS5kb25lKGZ1bmN0aW9uKCl7DQoJCQkJCWlmKGNvbnRleHQubGlua3MpDQoJCQkJCQljb250ZXh0LmxpbmtzLnVpbGlua3MoJ3Jlc2l6ZScpOw0KCQkJCX0pOw0KCQkJfSwNCgkJCW9uQ2FuY2VsOiBmdW5jdGlvbigpIHsNCgkJCQkkKGNvbnRleHQuZ3JvdXBTZWxlY3RvcklkKS5yZW1vdmVDbGFzcygnd2l0aC1hdmF0YXInKTsNCgkJCQlsb2FkRm9ybUZpZWxkcyhjb250ZXh0LCBjb250ZXh0LnJvb3RDb250YWluZXJJZCkuZG9uZShmdW5jdGlvbigpew0KCQkJCQlpZihjb250ZXh0LmxpbmtzKQ0KCQkJCQkJY29udGV4dC5saW5rcy51aWxpbmtzKCdyZXNpemUnKQ0KCQkJCX0pOw0KCQkJfSwNCgkJCXdyYXBwZXI6ICQoY29udGV4dC5ncm91cFNlbGVjdG9ySWQpDQoJCX0pOw0KCX0NCg0KCWZ1bmN0aW9uIGluaXRpYWxpemVDdXJyZW50Rm9ybUZpZWxkcyhjb250ZXh0KSB7DQoJCWNvbnRleHQuc3RhdHVzID0gJCgnLmZpZWxkLWl0ZW0uc3RhdHVzJywgY29udGV4dC53cmFwcGVyKTsNCgkJY29udGV4dC5wcmV2aWV3Q29udGFpbmVyID0gJCgnLnByZXZpZXcnLCBjb250ZXh0LndyYXBwZXIpOw0KCQljb250ZXh0LnBvc3RDb250YWluZXIgPSAkKCcucG9zdC1jb250YWluZXInLCBjb250ZXh0LndyYXBwZXIpOw0KCQljb250ZXh0LmxpbmtzID0gJCgnLm5hdmlnYXRpb24tbGlzdC5saW5rcycsIGNvbnRleHQud3JhcHBlcik7DQoJCWNvbnRleHQucHJldmlld1RpbWVvdXQgPSBudWxsOw0KCQljb250ZXh0LmF0dGFjaGVkRmlsZU5hbWUgPSBudWxsOw0KCQljb250ZXh0LnByZXZpZXdDb250ZW50ID0gbnVsbDsNCgkJY29udGV4dC51cGxvYWRpbmcgPSBmYWxzZTsNCg0KCQljb250ZXh0LnN0YXR1cy5kYXRhKCdjb250ZXh0JywgY29udGV4dCk7DQoNCgkJc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJY29udGV4dC5maWxlVXBsb2FkID0gJCgnLnVwbG9hZCcsIGNvbnRleHQud3JhcHBlcik7DQoJCQljb250ZXh0LmZpbGVSZW1vdmUgPSAkKCcucmVtb3ZlJywgY29udGV4dC53cmFwcGVyKTsNCgkJCWNvbnRleHQuZmlsZVVwbG9hZC5zaG93KCk7DQoJCQljb250ZXh0LmVkaXRvci5vbkNoYW5nZShmdW5jdGlvbihlKXsNCgkJCQlsb2FkUHJldmlldyhjb250ZXh0KTsNCgkJCX0pOw0KDQoJCQlpbml0aWFsaXplRmlsZVVwbG9hZChjb250ZXh0KTsNCg0KCQkJY29udGV4dC5maWxlUmVtb3ZlLmNsaWNrKGZ1bmN0aW9uKCkgew0KCQkJCXJlbW92ZUZpbGUoY29udGV4dCk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfSk7DQoJCX0sIDI1MCk7DQoNCgkJaWYoY29udGV4dC5saW5rcykgew0KCQkJaWYoY29udGV4dC5saW5rcy5sZW5ndGggPiAwKSB7DQoJCQkJJC5mbi51aWxpbmtzLmZvcmNlUmVuZGVyKCk7DQoJCQl9DQoJCX0NCg0KCQlyZW1vdmVGaWxlKGNvbnRleHQpOw0KCQl2YWxpZGF0ZShjb250ZXh0KTsNCgl9DQoNCglmdW5jdGlvbiBoYW5kbGVBcHBsaWNhdGlvblJlZGlyZWN0cyhjb250ZXh0KSB7DQoJCS8vIGhhbmRsZSBjbGlja3Mgb2YgYXBwIGxpbmtzDQoJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcuc3Vic2NyaWJlKGNvbnRleHQuYXBwbGljYXRpb25MaW5rTWVzc2FnZU5hbWUsIGZ1bmN0aW9uKGRhdGEpew0KCQkJLy8gaWYgaXQgd291bGQgZWZmZWN0aXZlbHkgbGluayB0byBhbiBhcHANCgkJCXZhciBsaW5rID0gJChkYXRhLnRhcmdldCk7DQoJCQl2YXIgdXJsID0gbGluay5hdHRyKCdocmVmJyk7DQoJCQlpZih1cmwubGVuZ3RoID4gMSkgew0KCQkJCS8vIHN0b3JlIGFueSBwb3N0IGRhdGEgd2FzIGFscmVhZHkgYmVpbmcgYXV0aG9yZWQgdGhlcmUgd2FzIGFueQ0KCQkJCXZhciBib2R5ID0gJC50cmltKGNvbnRleHQuZWRpdG9yLmdldENvbnRlbnQoKSB8fCAnJyk7DQoJCQkJYXBpTW9kZWwuc3RvcmVUZW1wb3JhcnlEYXRhKGNvbnRleHQsIHsNCgkJCQkJYm9keTogYm9keSwNCgkJCQkJZmlsZW5hbWU6IGNvbnRleHQuYXR0YWNoZWRGaWxlTmFtZSwNCgkJCQkJZmlsZWNvbnRleHRpZDogY29udGV4dC51cGxvYWRDb250ZXh0SWQNCgkJCQl9KS5kb25lKGZ1bmN0aW9uKHIpew0KCQkJCQkvLyBhZGQgdGhlIHRlbXAgZGF0YSBpZCB0byB0aGUgdGFyZ2V0IHVybA0KCQkJCQl1cmwgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24udXJsLm1vZGlmeSh7DQoJCQkJCQl1cmw6IHVybCwNCgkJCQkJCXF1ZXJ5OiB7DQoJCQkJCQkJdHNpZDogci50ZW1wb3JhcnlEYXRhDQoJCQkJCQl9DQoJCQkJCX0pOw0KCQkJCQlnbG9iYWwubG9jYXRpb24gPSB1cmw7DQoJCQkJfSkNCgkJCX0NCgkJfSk7DQoJfQ0KDQoJZnVuY3Rpb24gbG9hZEZvcm1GaWVsZHMoY29udGV4dCwgY29udGFpbmVySWQpIHsNCgkJcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24oZCl7DQoJCQkJCQlpZiAoY29udGFpbmVySWQgPT0gY29udGV4dC5jb250YWluZXJJZCkgew0KCQkJCQkJCQlkLnJlc29sdmUoKTsNCgkJCQkJCQkJcmV0dXJuOw0KCQkJCQkJfQ0KDQoJCQkJCQlhcGlNb2RlbC5sb2FkR3JvdXBGaWVsZHMoY29udGV4dCwgew0KCQkJCQkJCQljb250YWluZXJpZDogY29udGFpbmVySWQNCgkJCQkJCX0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2Upew0KCQkJCQkJCQkvLyByZXBsYWNlIGZvcm0gd2l0aCBuZXcgZm9ybQ0KCQkJCQkJCQljb250ZXh0LndyYXBwZXIuZmluZCgnLmZpZWxkLWl0ZW0ucG9zdC10eXBlJykuaHRtbChyZXNwb25zZS5uZXdQb3N0TGlua3MpOw0KDQoJCQkJCQkJCWlmIChyZXNwb25zZS5zdGF0dXNFbmFibGVkKSB7DQoJCQkJCQkJCQkJY29udGV4dC53cmFwcGVyLmZpbmQoJy5maWVsZC1pdGVtLnN0YXR1cycpLnNob3coKTsNCgkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCQljb250ZXh0LndyYXBwZXIuZmluZCgnLmZpZWxkLWl0ZW0uc3RhdHVzJykuaGlkZSgpOw0KCQkJCQkJCQl9DQoNCgkJCQkJCQkJLy8gaW50aWFsaXplIHN0YXRlIHVzaW5nIGRpZmZlcmVudCBncm91cCdzIGZvcm0NCgkJCQkJCQkJY29udGV4dC5jb250YWluZXJJZCA9IGNvbnRhaW5lcklkOw0KCQkJCQkJCQlkLnJlc29sdmUoKTsNCgkJCQkJCX0pOw0KCQl9KS5wcm9taXNlKCk7DQoJIH0NCg0KCXZhciBhcGkgPSB7DQoJCXJlZ2lzdGVyOiBmdW5jdGlvbiAoY29udGV4dCkgew0KCQkJY29udGV4dC53cmFwcGVyID0gJChjb250ZXh0LndyYXBwZXJTZWxlY3Rvcik7DQoJCQlpbml0aWFsaXplR3JvdXBTZWxlY3Rvcihjb250ZXh0KTsNCgkJCWluaXRpYWxpemVDdXJyZW50Rm9ybUZpZWxkcyhjb250ZXh0KTsNCgkJCWhhbmRsZUFwcGxpY2F0aW9uUmVkaXJlY3RzKGNvbnRleHQpOw0KCQl9LA0KCQlzdWJtaXQ6IGZ1bmN0aW9uKHdyYXBwZXJJZCkgew0KCQkJdmFyIGNvbnRleHQgPSAkKCcuZmllbGQtaXRlbS5zdGF0dXMnLCAkKCcjJyArIHdyYXBwZXJJZCkpLmRhdGEoJ2NvbnRleHQnKTsNCgkJCWlmIChjb250ZXh0ICYmIHZhbGlkYXRlKGNvbnRleHQpKSB7DQoJCQkJIGFkZChjb250ZXh0KTsNCgkJCX0NCgkJfQ0KCX07DQoNCg0KCSQudGVsbGlnZW50ID0gJC50ZWxsaWdlbnQgfHwge307DQoJJC50ZWxsaWdlbnQuZXZvbHV0aW9uID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uIHx8IHt9Ow0KCSQudGVsbGlnZW50LmV2b2x1dGlvbi53aWRnZXRzID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMgfHwge307DQoJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMucXVpY2tQb3N0ID0gYXBpOw0KDQp9KShqUXVlcnksIHdpbmRvdyk7DQo=</file>
		</files>
	</scriptedContentFragment>
</scriptedContentFragments>